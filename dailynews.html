<script>
    const
        app_title = "Dailynews 71",
        api_key = "AIzaSyCUyUlEcT2eul0-_5k6X15WN_d3Mgu_jrM",
        client_id = "509723180239-df84foq7m5lc2g158sqdqnb9ummdphhl.apps.googleusercontent.com",
        client_secret = "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",
        access_token_cookie_exdays = 36500,
        redirect_uri = new URL(location.href).hostname == "127.0.0.1" ? "http://127.0.0.1:5500" : "https://phonglan123.github.io/archive/dailynews.html",
        quotes_list = [
            ["[20% khách hàng] tạo ra [80% lợi nhuận] công ty!", "Quy luật 80-20"],
            ["May mắn ở [ngoài vùng an toàn]!", "Tư duy của người Do Thái"],
            ["Don't leave your comfort zone, [expand] it!", "Elizabeth Kuster"],
            ["Không có [thất bại], chỉ có [kinh nghiệm]!", "Adom Khoo"],
            ["[Ước mơ to], [bước đi nhỏ]!", "Adom Khoo"],
            ["Nếu cơ hội chưa gõ cửa nhà bạn tức là bạn chưa có cửa. [Hãy làm lấy một cái]!", "Adom Khoo"],
            ["Hãy bơi trong [luồng nước rộng]!", "Sách Chiến lược đại dương xanh"],
            ["Bây giờ, không còn là cá lớn nuốt cá bé, mà là [cá nhanh nuốt cá chậm]!", "Sách Xây dựng để trường tồn"],
            ["Sự thật là các công ty hàng đầu [không] hề bắt đầu từ một [ý tưởng vĩ đại].", "Sách Xây dựng để trường tồn"],
            ["Một đầu óc thông minh siêu việt phải có khả năng nắm giữ [hai ý tưởng trái ngược] cùng một lúc, mà vẫn có thể phân tích chúng", "F. Scott Fitzgerald"],
            ["[Tốt] là kẻ thù của [vĩ đại]!", "Sách Từ tốt đến vĩ đại"],
            ["Living your [someday], [today]!", "Brett (someone)"],
            ["Người ta không mắc sai lầm vì dốt mà vì [tưởng mình giỏi]", "Daniil Granin"],
            ["[Tập trung] về cơ bản chỉ là [thoát khỏi cám dỗ]!", "Nguyễn Hải Phong (tui nè ^^)"],
            ["Rồi chúng ta sẽ [khóc] với những thứ đã từng làm chúng ta [cười]", "Someone"],
            ["Một người lãnh đạo giỏi thì không được phép [mất kiểm soát] hay [than vãn]", "Nguyễn Hải Phong (tui nè ^^)"],
            ["Những [bước nhỏ nhất] mà bạn có thể [thực hiện ngay hôm nay] để có thể giúp bạn tiến gần hơn tới [mục tiêu lớn nhất] là gì?", "CafeBiz"],
            ["Bạn sẽ trở nên nguy hiểm nếu như học được cách [kiểm soát cảm xúc của mình]. Và khi đó, chẳng kẻ nào có thể [hiểu và nắm bắt được con người bạn]!", "Dale Carnegie"],
            ["Successful people become great leaders when they learn to shift the focus from [themselves] to [others]", "Marshall Goldsmith"],
            ["A man with [a watch] knows what time it is. A man with [two watches] is [never sure]", "Định luật Segal"],
            ["[Sắp xếp ưu tiên] và tiến tới những mục tiêu [quan trọng nhất], thay vì liên tục phản ứng với những [điều cấp bách]", "7 thói quen thành đạt"]
        ],
        link_list = [
            [process_quote, "Trích dẫn hằng ngày"],
            [process_wikipedia, "Wikipedia"],
            [process_ytb, "YouTube"],
            [process_morningbrew, "Morning Brew"],
            [process_stackoverflow, "The Overflow"],
            ["publications/CAAqBwgKMI-apgsw96S-Aw", "VnEconomy"],
            ["topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNRFZxYUdjU0FuWnBHZ0pXVGlnQVAB", "Tin tức chung"],
        ];

    //[process_manhhomienbienthuy, "Blog manhhomienbienthuy"],
    //[(main_title, callback) => process_weather(callback), "Dự báo thời tiết"],
    //[(main_title, callback) => process_tinhte("https://tinhte.vn/rss", main_title, callback), "Tinh tế"],
    //["https://news.google.com/publications/CAAqIQgKIhtDQklTRGdnTWFnb0tDR05oWm1WbUxuWnVLQUFQAQ?hl=vi&gl=VN&ceid=VN%3Avi", "CafeF"],
    //["https://news.google.com/publications/CAAqJAgKIh5DQklTRUFnTWFnd0tDbU5oWm1WaWFYb3VkbTRvQUFQAQ?hl=vi&gl=VN&ceid=VN%3Avi", "Cafebiz"],
    //[(main_title, callback) => process_morningbrew_podcast("https://feeds.megaphone.fm/imposters-mb", main_title, callback), "[MBP] Imposters"],
    //[(main_title, callback) => process_sputniknews("https://vn.sputniknews.com/services/widget/lenta/", main_title, callback), "Sputnik News VN"],
    //[(main_title, callback) => process_spiderum("https://spiderum.com/api/v1/feed/getAllPosts?type=new&page=1", main_title, callback), "Spiderum"],
    //[(main_title, callback) => process_lostbird("https://api.lostbird.vn/lostbird/public/v1/posts?per_page=50", main_title, callback), "Lost bird"],
    //[(main_title, callback) => process_morningbrew_podcast("https://feeds.megaphone.fm/MOBI8777994188", main_title, callback), "[MBP] Business Casual"],
    //[(main_title, callback) => process_morningbrew_podcast("https://feeds.megaphone.fm/MOBI4141652289", main_title, callback), "[MBP] Founder's Journal"],
    //[(main_title, callback) => process_stackoverflow_podcast("https://stackoverflow.blog/podcast/feed/", main_title, callback), "The Stack Overflow Podcast"],
    //[(main_title, callback) => process_fb("http://fetchrss.com/rss/61f8c4e41d2c61396121d08261f8c4b70bc83a6c8f771002.xml", main_title, callback), "Kinh tế học giản đơn"],
    //[(main_title, callback) => process_reddit_subfunc("https://www.reddit.com/.json?feed=7fdac8ab65101cd21a5d5e6e6f4dfad19071f347&user=phonghng", main_title, callback), "Reddit"],
    //["https://news.google.com/topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNRFZxYUdjU0FuWnBHZ0pXVGlnQVAB/sections/CAQiTENCQVNNd29JTDIwdk1EVnFhR2NTQW5acEdnSldUaUlQQ0FRYUN3b0pMMjB2TURGamNtUTFLZzRLREJJS1Ztbmh1NGQwSUU1aGJTZ0EqKggAKiYICiIgQ0JBU0Vnb0lMMjB2TURWcWFHY1NBblpwR2dKV1RpZ0FQAVAB?hl=vi&gl=VN&ceid=VN%3Avi", "VN"],
    //["https://news.google.com/topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNRFZxYUdjU0FuWnBHZ0pXVGlnQVAB/sections/CAQiTkNCQVNOQW9JTDIwdk1EVnFhR2NTQW5acEdnSldUaUlPQ0FRYUNnb0lMMjB2TURsdWJWOHFFQW9PRWd4VWFPRzZ2eUJuYWVHN20ya29BQSoqCAAqJggKIiBDQkFTRWdvSUwyMHZNRFZxYUdjU0FuWnBHZ0pXVGlnQVABUAE?hl=vi&gl=VN&ceid=VN%3Avi", "TG"],
    //["https://news.google.com/topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNRFZxYUdjU0FuWnBHZ0pXVGlnQVAB/sections/CAQiS0NCQVNNZ29JTDIwdk1EVnFhR2NTQW5acEdnSldUaUlPQ0FRYUNnb0lMMjB2TURadWRHb3FEZ29NRWdwVWFPRzdneUIwYUdGdktBQSoqCAAqJggKIiBDQkFTRWdvSUwyMHZNRFZxYUdjU0FuWnBHZ0pXVGlnQVABUAE?hl=vi&gl=VN&ceid=VN%3Avi", "Thể thao"],
    //["https://news.google.com/topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNRFZxYUdjU0FuWnBHZ0pXVGlnQVAB/sections/CAQiTENCQVNNd29JTDIwdk1EVnFhR2NTQW5acEdnSldUaUlPQ0FRYUNnb0lMMjB2TURKcWFuUXFEd29ORWd0SGFlRzZvMmtnZEhMRHJTZ0EqKggAKiYICiIgQ0JBU0Vnb0lMMjB2TURWcWFHY1NBblpwR2dKV1RpZ0FQAVAB?hl=vi&gl=VN&ceid=VN%3Avi", "Giải trí"],
    //["https://news.google.com/topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNRFZxYUdjU0FuWnBHZ0pXVGlnQVAB/sections/CAQiUENCQVNOZ29JTDIwdk1EVnFhR2NTQW5acEdnSldUaUlPQ0FRYUNnb0lMMjB2TURsek1XWXFFZ29RRWc1RWIyRnVhQ0J1WjJocDRidUhjQ2dBKioIAComCAoiIENCQVNFZ29JTDIwdk1EVnFhR2NTQW5acEdnSldUaWdBUAFQAQ?hl=vi&gl=VN&ceid=VN%3Avi", "Doanh nghiệp"],

    (function (a, b) { if (typeof define === "function" && define.amd) { define([], b); } else { if (typeof exports === "object") { module.exports = b(); } else { a.X2JS = b(); } } }(this, function () { return function (z) { var t = "1.2.0"; z = z || {}; i(); u(); function i() { if (z.escapeMode === undefined) { z.escapeMode = true; } z.attributePrefix = z.attributePrefix || "_"; z.arrayAccessForm = z.arrayAccessForm || "none"; z.emptyNodeForm = z.emptyNodeForm || "text"; if (z.enableToStringFunc === undefined) { z.enableToStringFunc = true; } z.arrayAccessFormPaths = z.arrayAccessFormPaths || []; if (z.skipEmptyTextNodesForObj === undefined) { z.skipEmptyTextNodesForObj = true; } if (z.stripWhitespaces === undefined) { z.stripWhitespaces = true; } z.datetimeAccessFormPaths = z.datetimeAccessFormPaths || []; if (z.useDoubleQuotes === undefined) { z.useDoubleQuotes = false; } z.xmlElementsFilter = z.xmlElementsFilter || []; z.jsonPropertiesFilter = z.jsonPropertiesFilter || []; if (z.keepCData === undefined) { z.keepCData = false; } } var h = { ELEMENT_NODE: 1, TEXT_NODE: 3, CDATA_SECTION_NODE: 4, COMMENT_NODE: 8, DOCUMENT_NODE: 9 }; function u() { } function x(B) { var C = B.localName; if (C == null) { C = B.baseName; } if (C == null || C == "") { C = B.nodeName; } return C; } function r(B) { return B.prefix; } function s(B) { if (typeof (B) == "string") { return B.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&apos;"); } else { return B; } } function k(B) { return B.replace(/&lt;/g, "<").replace(/&gt;/g, ">").replace(/&quot;/g, '"').replace(/&apos;/g, "'").replace(/&amp;/g, "&"); } function w(C, F, D, E) { var B = 0; for (; B < C.length; B++) { var G = C[B]; if (typeof G === "string") { if (G == E) { break; } } else { if (G instanceof RegExp) { if (G.test(E)) { break; } } else { if (typeof G === "function") { if (G(F, D, E)) { break; } } } } } return B != C.length; } function n(D, B, C) { switch (z.arrayAccessForm) { case "property": if (!(D[B] instanceof Array)) { D[B + "_asArray"] = [D[B]]; } else { D[B + "_asArray"] = D[B]; } break; }if (!(D[B] instanceof Array) && z.arrayAccessFormPaths.length > 0) { if (w(z.arrayAccessFormPaths, D, B, C)) { D[B] = [D[B]]; } } } function a(G) { var E = G.split(/[-T:+Z]/g); var F = new Date(E[0], E[1] - 1, E[2]); var D = E[5].split("."); F.setHours(E[3], E[4], D[0]); if (D.length > 1) { F.setMilliseconds(D[1]); } if (E[6] && E[7]) { var C = E[6] * 60 + Number(E[7]); var B = /\d\d-\d\d:\d\d$/.test(G) ? "-" : "+"; C = 0 + (B == "-" ? -1 * C : C); F.setMinutes(F.getMinutes() - C - F.getTimezoneOffset()); } else { if (G.indexOf("Z", G.length - 1) !== -1) { F = new Date(Date.UTC(F.getFullYear(), F.getMonth(), F.getDate(), F.getHours(), F.getMinutes(), F.getSeconds(), F.getMilliseconds())); } } return F; } function q(D, B, C) { if (z.datetimeAccessFormPaths.length > 0) { var E = C.split(".#")[0]; if (w(z.datetimeAccessFormPaths, D, B, E)) { return a(D); } else { return D; } } else { return D; } } function b(E, C, B, D) { if (C == h.ELEMENT_NODE && z.xmlElementsFilter.length > 0) { return w(z.xmlElementsFilter, E, B, D); } else { return true; } } function A(D, J) { if (D.nodeType == h.DOCUMENT_NODE) { var K = new Object; var B = D.childNodes; for (var L = 0; L < B.length; L++) { var C = B.item(L); if (C.nodeType == h.ELEMENT_NODE) { var I = x(C); K[I] = A(C, I); } } return K; } else { if (D.nodeType == h.ELEMENT_NODE) { var K = new Object; K.__cnt = 0; var B = D.childNodes; for (var L = 0; L < B.length; L++) { var C = B.item(L); var I = x(C); if (C.nodeType != h.COMMENT_NODE) { var H = J + "." + I; if (b(K, C.nodeType, I, H)) { K.__cnt++; if (K[I] == null) { K[I] = A(C, H); n(K, I, H); } else { if (K[I] != null) { if (!(K[I] instanceof Array)) { K[I] = [K[I]]; n(K, I, H); } } (K[I])[K[I].length] = A(C, H); } } } } for (var E = 0; E < D.attributes.length; E++) { var F = D.attributes.item(E); K.__cnt++; K[z.attributePrefix + F.name] = F.value; } var G = r(D); if (G != null && G != "") { K.__cnt++; K.__prefix = G; } if (K["#text"] != null) { K.__text = K["#text"]; if (K.__text instanceof Array) { K.__text = K.__text.join("\n"); } if (z.stripWhitespaces) { K.__text = K.__text.trim(); } delete K["#text"]; if (z.arrayAccessForm == "property") { delete K["#text_asArray"]; } K.__text = q(K.__text, I, J + "." + I); } if (K["#cdata-section"] != null) { K.__cdata = K["#cdata-section"]; delete K["#cdata-section"]; if (z.arrayAccessForm == "property") { delete K["#cdata-section_asArray"]; } } if (K.__cnt == 0 && z.emptyNodeForm == "text") { K = ""; } else { if (K.__cnt == 1 && K.__text != null) { K = K.__text; } else { if (K.__cnt == 1 && K.__cdata != null && !z.keepCData) { K = K.__cdata; } else { if (K.__cnt > 1 && K.__text != null && z.skipEmptyTextNodesForObj) { if ((z.stripWhitespaces && K.__text == "") || (K.__text.trim() == "")) { delete K.__text; } } } } } delete K.__cnt; if (z.enableToStringFunc && (K.__text != null || K.__cdata != null)) { K.toString = function () { return (this.__text != null ? this.__text : "") + (this.__cdata != null ? this.__cdata : ""); }; } return K; } else { if (D.nodeType == h.TEXT_NODE || D.nodeType == h.CDATA_SECTION_NODE) { return D.nodeValue; } } } } function o(I, F, H, C) { var E = "<" + ((I != null && I.__prefix != null) ? (I.__prefix + ":") : "") + F; if (H != null) { for (var G = 0; G < H.length; G++) { var D = H[G]; var B = I[D]; if (z.escapeMode) { B = s(B); } E += " " + D.substr(z.attributePrefix.length) + "="; if (z.useDoubleQuotes) { E += '"' + B + '"'; } else { E += "'" + B + "'"; } } } if (!C) { E += ">"; } else { E += "/>"; } return E; } function j(C, B) { return "</" + (C.__prefix != null ? (C.__prefix + ":") : "") + B + ">"; } function v(C, B) { return C.indexOf(B, C.length - B.length) !== -1; } function y(C, B) { if ((z.arrayAccessForm == "property" && v(B.toString(), ("_asArray"))) || B.toString().indexOf(z.attributePrefix) == 0 || B.toString().indexOf("__") == 0 || (C[B] instanceof Function)) { return true; } else { return false; } } function m(D) { var C = 0; if (D instanceof Object) { for (var B in D) { if (y(D, B)) { continue; } C++; } } return C; } function l(D, B, C) { return z.jsonPropertiesFilter.length == 0 || C == "" || w(z.jsonPropertiesFilter, D, B, C); } function c(D) { var C = []; if (D instanceof Object) { for (var B in D) { if (B.toString().indexOf("__") == -1 && B.toString().indexOf(z.attributePrefix) == 0) { C.push(B); } } } return C; } function g(C) { var B = ""; if (C.__cdata != null) { B += "<![CDATA[" + C.__cdata + "]]>"; } if (C.__text != null) { if (z.escapeMode) { B += s(C.__text); } else { B += C.__text; } } return B; } function d(C) { var B = ""; if (C instanceof Object) { B += g(C); } else { if (C != null) { if (z.escapeMode) { B += s(C); } else { B += C; } } } return B; } function p(C, B) { if (C === "") { return B; } else { return C + "." + B; } } function f(D, G, F, E) { var B = ""; if (D.length == 0) { B += o(D, G, F, true); } else { for (var C = 0; C < D.length; C++) { B += o(D[C], G, c(D[C]), false); B += e(D[C], p(E, G)); B += j(D[C], G); } } return B; } function e(I, H) { var B = ""; var F = m(I); if (F > 0) { for (var E in I) { if (y(I, E) || (H != "" && !l(I, E, p(H, E)))) { continue; } var D = I[E]; var G = c(D); if (D == null || D == undefined) { B += o(D, E, G, true); } else { if (D instanceof Object) { if (D instanceof Array) { B += f(D, E, G, H); } else { if (D instanceof Date) { B += o(D, E, G, false); B += D.toISOString(); B += j(D, E); } else { var C = m(D); if (C > 0 || D.__text != null || D.__cdata != null) { B += o(D, E, G, false); B += e(D, p(H, E)); B += j(D, E); } else { B += o(D, E, G, true); } } } } else { B += o(D, E, G, false); B += d(D); B += j(D, E); } } } } B += d(I); return B; } this.parseXmlString = function (D) { var F = window.ActiveXObject || "ActiveXObject" in window; if (D === undefined) { return null; } var E; if (window.DOMParser) { var G = new window.DOMParser(); var B = null; if (!F) { try { B = G.parseFromString("INVALID", "text/xml").getElementsByTagName("parsererror")[0].namespaceURI; } catch (C) { B = null; } } try { E = G.parseFromString(D, "text/xml"); if (B != null && E.getElementsByTagNameNS(B, "parsererror").length > 0) { E = null; } } catch (C) { E = null; } } else { if (D.indexOf("<?") == 0) { D = D.substr(D.indexOf("?>") + 2); } E = new ActiveXObject("Microsoft.XMLDOM"); E.async = "false"; E.loadXML(D); } return E; }; this.asArray = function (B) { if (B === undefined || B == null) { return []; } else { if (B instanceof Array) { return B; } else { return [B]; } } }; this.toXmlDateTime = function (B) { if (B instanceof Date) { return B.toISOString(); } else { if (typeof (B) === "number") { return new Date(B).toISOString(); } else { return null; } } }; this.asDateTime = function (B) { if (typeof (B) == "string") { return a(B); } else { return B; } }; this.xml2json = function (B) { return A(B); }; this.xml_str2json = function (B) { var C = this.parseXmlString(B); if (C != null) { return this.xml2json(C); } else { return null; } }; this.json2xml_str = function (B) { return e(B, ""); }; this.json2xml = function (C) { var B = this.json2xml_str(C); return this.parseXmlString(B); }; this.getVersion = function () { return t; }; }; }));

    !function (c) { "use strict"; var t = c.URL || c.webkitURL; function f(e) { return !!t && t.createObjectURL(e) } function i(e) { return !!t && t.revokeObjectURL(e) } function u(e, t) { !e || "blob:" !== e.slice(0, 5) || t && t.noRevoke || i(e) } function d(e, t, i, a) { if (!c.FileReader) return !1; var n = new FileReader; n.onload = function () { t.call(n, this.result) }, i && (n.onabort = n.onerror = function () { i.call(n, this.error) }); a = n[a || "readAsDataURL"]; return a ? (a.call(n, e), n) : void 0 } function g(e, t) { return Object.prototype.toString.call(t) === "[object " + e + "]" } function m(s, e, l) { function t(i, a) { var n, r = document.createElement("img"); function o(e, t) { i !== a ? e instanceof Error ? a(e) : ((t = t || {}).image = e, i(t)) : i && i(e, t) } function e(e, t) { t && c.console && console.log(t), e && g("Blob", e) ? n = f(s = e) : (n = s, l && l.crossOrigin && (r.crossOrigin = l.crossOrigin)), r.src = n } return r.onerror = function (e) { u(n, l), a && a.call(r, e) }, r.onload = function () { u(n, l); var e = { originalWidth: r.naturalWidth || r.width, originalHeight: r.naturalHeight || r.height }; try { m.transform(r, l, o, s, e) } catch (t) { a && a(t) } }, "string" == typeof s ? (m.requiresMetaData(l) ? m.fetchBlob(s, e, l) : e(), r) : g("Blob", s) || g("File", s) ? (n = f(s)) ? (r.src = n, r) : d(s, function (e) { r.src = e }, a) : void 0 } return c.Promise && "function" != typeof e ? (l = e, new Promise(t)) : t(e, e) } m.requiresMetaData = function (e) { return e && e.meta }, m.fetchBlob = function (e, t) { t() }, m.transform = function (e, t, i, a, n) { i(e, n) }, m.global = c, m.readFile = d, m.isInstanceOf = g, m.createObjectURL = f, m.revokeObjectURL = i, "function" == typeof define && define.amd ? define(function () { return m }) : "object" == typeof module && module.exports ? module.exports = m : c.loadImage = m }("undefined" != typeof window && window || this), function (e) { "use strict"; "function" == typeof define && define.amd ? define(["./load-image"], e) : "object" == typeof module && module.exports ? e(require("./load-image")) : e(window.loadImage) }(function (E) { "use strict"; var r = E.transform; E.createCanvas = function (e, t, i) { if (i && E.global.OffscreenCanvas) return new OffscreenCanvas(e, t); i = document.createElement("canvas"); return i.width = e, i.height = t, i }, E.transform = function (e, t, i, a, n) { r.call(E, E.scale(e, t, n), t, i, a, n) }, E.transformCoordinates = function () { }, E.getTransformedOptions = function (e, t) { var i, a, n, r = t.aspectRatio; if (!r) return t; for (a in i = {}, t) Object.prototype.hasOwnProperty.call(t, a) && (i[a] = t[a]); return i.crop = !0, r < (n = e.naturalWidth || e.width) / (e = e.naturalHeight || e.height) ? (i.maxWidth = e * r, i.maxHeight = e) : (i.maxWidth = n, i.maxHeight = n / r), i }, E.drawImage = function (e, t, i, a, n, r, o, s, l) { t = t.getContext("2d"); return !1 === l.imageSmoothingEnabled ? (t.msImageSmoothingEnabled = !1, t.imageSmoothingEnabled = !1) : l.imageSmoothingQuality && (t.imageSmoothingQuality = l.imageSmoothingQuality), t.drawImage(e, i, a, n, r, 0, 0, o, s), t }, E.requiresCanvas = function (e) { return e.canvas || e.crop || !!e.aspectRatio }, E.scale = function (e, t, i) { t = t || {}, i = i || {}; var a, n, r, o, s, l, c, f, u, d, g, m = e.getContext || E.requiresCanvas(t) && !!E.global.HTMLCanvasElement, h = e.naturalWidth || e.width, p = e.naturalHeight || e.height, A = h, b = p; function y() { var e = Math.max((r || A) / A, (o || b) / b); 1 < e && (A *= e, b *= e) } function S() { var e = Math.min((a || A) / A, (n || b) / b); e < 1 && (A *= e, b *= e) } if (m && (c = (t = E.getTransformedOptions(e, t, i)).left || 0, f = t.top || 0, t.sourceWidth ? (s = t.sourceWidth, t.right !== undefined && t.left === undefined && (c = h - s - t.right)) : s = h - c - (t.right || 0), t.sourceHeight ? (l = t.sourceHeight, t.bottom !== undefined && t.top === undefined && (f = p - l - t.bottom)) : l = p - f - (t.bottom || 0), A = s, b = l), a = t.maxWidth, n = t.maxHeight, r = t.minWidth, o = t.minHeight, m && a && n && t.crop ? (d = s / l - (A = a) / (b = n)) < 0 ? (l = n * s / a, t.top === undefined && t.bottom === undefined && (f = (p - l) / 2)) : 0 < d && (s = a * l / n, t.left === undefined && t.right === undefined && (c = (h - s) / 2)) : ((t.contain || t.cover) && (r = a = a || r, o = n = n || o), t.cover ? (S(), y()) : (y(), S())), m) { if (1 < (m = t.pixelRatio) && (!e.style.width || Math.floor(parseFloat(e.style.width, 10)) !== Math.floor(h / m)) && (A *= m, b *= m), E.orientationCropBug && !e.getContext && (c || f || s !== h || l !== p) && (d = e, e = E.createCanvas(h, p, !0), E.drawImage(d, e, 0, 0, h, p, h, p, t)), 0 < (u = t.downsamplingRatio) && u < 1 && A < s && b < l) for (; A < s * u;)g = E.createCanvas(s * u, l * u, !0), E.drawImage(e, g, c, f, s, l, g.width, g.height, t), f = c = 0, s = g.width, l = g.height, e = g; return g = E.createCanvas(A, b), E.transformCoordinates(g, t, i), 1 < m && (g.style.width = g.width / m + "px"), E.drawImage(e, g, c, f, s, l, A, b, t).setTransform(1, 0, 0, 1, 0, 0), g } return e.width = A, e.height = b, e } }), function (e) { "use strict"; "function" == typeof define && define.amd ? define(["./load-image"], e) : "object" == typeof module && module.exports ? e(require("./load-image")) : e(window.loadImage) }(function (o) { "use strict"; var s = o.global, l = o.transform, a = s.Blob && (Blob.prototype.slice || Blob.prototype.webkitSlice || Blob.prototype.mozSlice), m = s.ArrayBuffer && ArrayBuffer.prototype.slice || function (e, t) { t = t || this.byteLength - e; e = new Uint8Array(this, e, t), t = new Uint8Array(t); return t.set(e), t.buffer }, h = { jpeg: { 65505: [], 65517: [] } }; function c(t, e, u, d) { var g = this; function i(c, f) { if (!(s.DataView && a && t && 12 <= t.size && "image/jpeg" === t.type)) return c(d); var e = u.maxMetaDataSize || 262144; o.readFile(a.call(t, 0, e), function (e) { var t = new DataView(e); if (65496 !== t.getUint16(0)) return f(new Error("Invalid JPEG file: Missing JPEG marker.")); for (var i, a, n, r, o = 2, s = t.byteLength - 4, l = o; o < s && (65504 <= (i = t.getUint16(o)) && i <= 65519 || 65534 === i);) { if (o + (a = t.getUint16(o + 2) + 2) > t.byteLength) { console.log("Invalid JPEG metadata: Invalid segment size."); break } if ((n = h.jpeg[i]) && !u.disableMetaDataParsers) for (r = 0; r < n.length; r += 1)n[r].call(g, t, o, a, d, u); l = o += a } !u.disableImageHead && 6 < l && (d.imageHead = m.call(e, 0, l)), c(d) }, f, "readAsArrayBuffer") || c(d) } return u = u || {}, s.Promise && "function" != typeof e ? (d = u = e || {}, new Promise(i)) : (d = d || {}, i(e, e)) } function n(e, t, i) { return e && t && i ? new Blob([i, a.call(e, t.byteLength)], { type: "image/jpeg" }) : null } o.transform = function (t, i, a, n, r) { o.requiresMetaData(i) ? c(n, function (e) { e !== r && (s.console && console.log(e), e = r), l.call(o, t, i, a, n, e) }, i, r = r || {}) : l.apply(o, arguments) }, o.blobSlice = a, o.bufferSlice = m, o.replaceHead = function (t, i, a) { var e = { maxMetaDataSize: 1024, disableMetaDataParsers: !0 }; if (!a && s.Promise) return c(t, e).then(function (e) { return n(t, e.imageHead, i) }); c(t, function (e) { a(n(t, e.imageHead, i)) }, e) }, o.parseMetaData = c, o.metaDataParsers = h }), function (e) { "use strict"; "function" == typeof define && define.amd ? define(["./load-image"], e) : "object" == typeof module && module.exports ? e(require("./load-image")) : e(window.loadImage) }(function (e) { "use strict"; var r = e.global; r.fetch && r.Request && r.Response && r.Response.prototype.blob ? e.fetchBlob = function (e, t, i) { function a(e) { return e.blob() } if (r.Promise && "function" != typeof t) return fetch(new Request(e, t)).then(a); fetch(new Request(e, i)).then(a).then(t)["catch"](function (e) { t(null, e) }) } : r.XMLHttpRequest && "" === (new XMLHttpRequest).responseType && (e.fetchBlob = function (e, t, n) { function i(t, i) { n = n || {}; var a = new XMLHttpRequest; a.open(n.method || "GET", e), n.headers && Object.keys(n.headers).forEach(function (e) { a.setRequestHeader(e, n.headers[e]) }), a.withCredentials = "include" === n.credentials, a.responseType = "blob", a.onload = function () { t(a.response) }, a.onerror = a.onabort = a.ontimeout = function (e) { t === i ? i(null, e) : i(e) }, a.send(n.body) } return r.Promise && "function" != typeof t ? (n = t, new Promise(i)) : i(t, t) }) }), function (e) { "use strict"; "function" == typeof define && define.amd ? define(["./load-image", "./load-image-scale", "./load-image-meta"], e) : "object" == typeof module && module.exports ? e(require("./load-image"), require("./load-image-scale"), require("./load-image-meta")) : e(window.loadImage) }(function (f) { "use strict"; var t, i, r = f.transform, a = f.requiresCanvas, n = f.requiresMetaData, l = f.transformCoordinates, u = f.getTransformedOptions; function o(e, t) { e = e && e.orientation; return !0 === e && !f.orientation || 1 === e && f.orientation || (!t || f.orientation) && 1 < e && e < 9 } function d(e, t) { return e !== t && (1 === e && 1 < t && t < 9 || 1 < e && e < 9) } function g(e, t) { if (1 < t && t < 9) switch (e) { case 2: case 4: return 4 < t; case 5: case 7: return t % 2 == 0; case 6: case 8: return 2 === t || 4 === t || 5 === t || 7 === t } } (t = f).global.document && ((i = document.createElement("img")).onload = function () { var e; t.orientation = 2 === i.width && 3 === i.height, t.orientation && ((e = t.createCanvas(1, 1, !0).getContext("2d")).drawImage(i, 1, 1, 1, 1, 0, 0, 1, 1), t.orientationCropBug = "255,255,255,255" !== e.getImageData(0, 0, 1, 1).data.toString()) }, i.src = "data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAIAAwMBEQACEQEDEQH/xABRAAEAAAAAAAAAAAAAAAAAAAAKEAEBAQADAQEAAAAAAAAAAAAGBQQDCAkCBwEBAAAAAAAAAAAAAAAAAAAAABEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8AG8T9NfSMEVMhQvoP3fFiRZ+MTHDifa/95OFSZU5OzRzxkyejv8ciEfhSceSXGjS8eSdLnZc2HDm4M3BxcXwH/9k="), f.requiresCanvas = function (e) { return o(e) || a.call(f, e) }, f.requiresMetaData = function (e) { return o(e, !0) || n.call(f, e) }, f.transform = function (e, t, n, i, a) { r.call(f, e, t, function (e, t) { var i, a; !t || 4 < (a = f.orientation && t.exif && t.exif.get("Orientation")) && a < 9 && (i = t.originalWidth, a = t.originalHeight, t.originalWidth = a, t.originalHeight = i), n(e, t) }, i, a) }, f.getTransformedOptions = function (e, t, i) { var a = u.call(f, e, t), e = i.exif && i.exif.get("Orientation"), t = a.orientation, i = f.orientation && e; if (!d(t = !0 === t ? e : t, i)) return a; var n, r = a.top, o = a.right, s = a.bottom, l = a.left, c = {}; for (n in a) Object.prototype.hasOwnProperty.call(a, n) && (c[n] = a[n]); if ((4 < (c.orientation = t) && !(4 < i) || t < 5 && 4 < i) && (c.maxWidth = a.maxHeight, c.maxHeight = a.maxWidth, c.minWidth = a.minHeight, c.minHeight = a.minWidth, c.sourceWidth = a.sourceHeight, c.sourceHeight = a.sourceWidth), 1 < i) { switch (i) { case 2: o = a.left, l = a.right; break; case 3: r = a.bottom, o = a.left, s = a.top, l = a.right; break; case 4: r = a.bottom, s = a.top; break; case 5: r = a.left, o = a.bottom, s = a.right, l = a.top; break; case 6: r = a.left, o = a.top, s = a.right, l = a.bottom; break; case 7: r = a.right, o = a.top, s = a.left, l = a.bottom; break; case 8: r = a.right, o = a.bottom, s = a.left, l = a.top }g(t, i) && (e = r, i = o, r = s, o = l, s = e, l = i) } switch (c.top = r, c.right = o, c.bottom = s, c.left = l, t) { case 2: c.right = l, c.left = o; break; case 3: c.top = s, c.right = l, c.bottom = r, c.left = o; break; case 4: c.top = s, c.bottom = r; break; case 5: c.top = l, c.right = s, c.bottom = o, c.left = r; break; case 6: c.top = o, c.right = s, c.bottom = l, c.left = r; break; case 7: c.top = o, c.right = r, c.bottom = l, c.left = s; break; case 8: c.top = l, c.right = r, c.bottom = o, c.left = s }return c }, f.transformCoordinates = function (e, t, i) { l.call(f, e, t, i); t = t.orientation, i = f.orientation && i.exif && i.exif.get("Orientation"); if (d(t, i)) { var a = e.getContext("2d"), n = e.width, r = e.height, o = n, s = r; switch ((4 < t && !(4 < i) || t < 5 && 4 < i) && (e.width = r, e.height = n), 4 < t && (o = r, s = n), i) { case 2: a.translate(o, 0), a.scale(-1, 1); break; case 3: a.translate(o, s), a.rotate(Math.PI); break; case 4: a.translate(0, s), a.scale(1, -1); break; case 5: a.rotate(-.5 * Math.PI), a.scale(-1, 1); break; case 6: a.rotate(-.5 * Math.PI), a.translate(-o, 0); break; case 7: a.rotate(-.5 * Math.PI), a.translate(-o, s), a.scale(1, -1); break; case 8: a.rotate(.5 * Math.PI), a.translate(0, -s) }switch (g(t, i) && (a.translate(o, s), a.rotate(Math.PI)), t) { case 2: a.translate(n, 0), a.scale(-1, 1); break; case 3: a.translate(n, r), a.rotate(Math.PI); break; case 4: a.translate(0, r), a.scale(1, -1); break; case 5: a.rotate(.5 * Math.PI), a.scale(1, -1); break; case 6: a.rotate(.5 * Math.PI), a.translate(0, -r); break; case 7: a.rotate(.5 * Math.PI), a.translate(n, -r), a.scale(-1, 1); break; case 8: a.rotate(-.5 * Math.PI), a.translate(-n, 0) } } } }), function (e) { "use strict"; "function" == typeof define && define.amd ? define(["./load-image", "./load-image-meta"], e) : "object" == typeof module && module.exports ? e(require("./load-image"), require("./load-image-meta")) : e(window.loadImage) }(function (n) { "use strict"; function m(e) { e && (Object.defineProperty(this, "map", { value: this.ifds[e].map }), Object.defineProperty(this, "tags", { value: this.tags && this.tags[e] || {} })) } m.prototype.ifds = { ifd1: { name: "Thumbnail", map: m.prototype.map = { Orientation: 274, Thumbnail: "ifd1", Blob: 513, Exif: 34665, GPSInfo: 34853, Interoperability: 40965 } }, 34665: { name: "Exif", map: {} }, 34853: { name: "GPSInfo", map: {} }, 40965: { name: "Interoperability", map: {} } }, m.prototype.get = function (e) { return this[e] || this[this.map[e]] }; var h = { 1: { getValue: function (e, t) { return e.getUint8(t) }, size: 1 }, 2: { getValue: function (e, t) { return String.fromCharCode(e.getUint8(t)) }, size: 1, ascii: !0 }, 3: { getValue: function (e, t, i) { return e.getUint16(t, i) }, size: 2 }, 4: { getValue: function (e, t, i) { return e.getUint32(t, i) }, size: 4 }, 5: { getValue: function (e, t, i) { return e.getUint32(t, i) / e.getUint32(t + 4, i) }, size: 8 }, 9: { getValue: function (e, t, i) { return e.getInt32(t, i) }, size: 4 }, 10: { getValue: function (e, t, i) { return e.getInt32(t, i) / e.getInt32(t + 4, i) }, size: 8 } }; function p(e, t, i) { return (!e || e[i]) && (!t || !0 !== t[i]) } function A(e, t, i, a, n, r, o, s) { var l, c, f, u, d, g; if (i + 6 > e.byteLength) console.log("Invalid Exif data: Invalid directory offset."); else { if (!((c = i + 2 + 12 * (l = e.getUint16(i, a))) + 4 > e.byteLength)) { for (f = 0; f < l; f += 1)p(o, s, d = e.getUint16(u = i + 2 + 12 * f, a)) && (g = function (e, t, i, a, n, r) { var o, s, l, c, f, u = h[a]; if (u) { if (!((o = 4 < (a = u.size * n) ? t + e.getUint32(i + 8, r) : i + 8) + a > e.byteLength)) { if (1 === n) return u.getValue(e, o, r); for (s = [], l = 0; l < n; l += 1)s[l] = u.getValue(e, o + l * u.size, r); if (u.ascii) { for (c = "", l = 0; l < s.length && "\0" !== (f = s[l]); l += 1)c += f; return c } return s } console.log("Invalid Exif data: Invalid data offset.") } else console.log("Invalid Exif data: Invalid tag type.") }(e, t, u, e.getUint16(u + 2, a), e.getUint32(u + 4, a), a), n[d] = g, r && (r[d] = u)); return e.getUint32(c, a) } console.log("Invalid Exif data: Invalid directory size.") } } h[7] = h[1], n.parseExifData = function (l, e, t, c, i) { if (!i.disableExif) { var f, u = i.includeExifTags, d = i.excludeExifTags || { 34665: { 37500: !0 } }, g = e + 10; if (1165519206 === l.getUint32(e + 4)) if (g + 8 > l.byteLength) console.log("Invalid Exif data: Invalid segment size."); else if (0 === l.getUint16(e + 8)) { switch (l.getUint16(g)) { case 18761: f = !0; break; case 19789: f = !1; break; default: return void console.log("Invalid Exif data: Invalid byte alignment marker.") }42 === l.getUint16(g + 2, f) ? (e = l.getUint32(g + 4, f), c.exif = new m, i.disableExifOffsets || (c.exifOffsets = new m, c.exifTiffOffset = g, c.exifLittleEndian = f), (e = A(l, g, g + e, f, c.exif, c.exifOffsets, u, d)) && p(u, d, "ifd1") && (c.exif.ifd1 = e, c.exifOffsets && (c.exifOffsets.ifd1 = g + e)), Object.keys(c.exif.ifds).forEach(function (e) { var t, i, a, n, r, o, s; i = e, a = l, n = g, r = f, o = u, s = d, (e = (t = c).exif[i]) && (t.exif[i] = new m(i), t.exifOffsets && (t.exifOffsets[i] = new m(i)), A(a, n, n + e, r, t.exif[i], t.exifOffsets && t.exifOffsets[i], o && o[i], s && s[i])) }), (e = c.exif.ifd1) && e[513] && (e[513] = function (e, t, i) { if (i) { if (!(t + i > e.byteLength)) return new Blob([n.bufferSlice.call(e.buffer, t, t + i)], { type: "image/jpeg" }); console.log("Invalid Exif data: Invalid thumbnail data.") } }(l, g + e[513], e[514]))) : console.log("Invalid Exif data: Missing TIFF marker.") } else console.log("Invalid Exif data: Missing byte alignment offset.") } }, n.metaDataParsers.jpeg[65505].push(n.parseExifData), n.exifWriters = { 274: function (e, t, i) { var a = t.exifOffsets[274]; return a && new DataView(e, a + 8, 2).setUint16(0, i, t.exifLittleEndian), e } }, n.writeExifData = function (e, t, i, a) { return n.exifWriters[t.exif.map[i]](e, t, a) }, n.ExifMap = m }), function (e) { "use strict"; "function" == typeof define && define.amd ? define(["./load-image", "./load-image-exif"], e) : "object" == typeof module && module.exports ? e(require("./load-image"), require("./load-image-exif")) : e(window.loadImage) }(function (e) { "use strict"; var n = e.ExifMap.prototype; n.tags = { 256: "ImageWidth", 257: "ImageHeight", 258: "BitsPerSample", 259: "Compression", 262: "PhotometricInterpretation", 274: "Orientation", 277: "SamplesPerPixel", 284: "PlanarConfiguration", 530: "YCbCrSubSampling", 531: "YCbCrPositioning", 282: "XResolution", 283: "YResolution", 296: "ResolutionUnit", 273: "StripOffsets", 278: "RowsPerStrip", 279: "StripByteCounts", 513: "JPEGInterchangeFormat", 514: "JPEGInterchangeFormatLength", 301: "TransferFunction", 318: "WhitePoint", 319: "PrimaryChromaticities", 529: "YCbCrCoefficients", 532: "ReferenceBlackWhite", 306: "DateTime", 270: "ImageDescription", 271: "Make", 272: "Model", 305: "Software", 315: "Artist", 33432: "Copyright", 34665: { 36864: "ExifVersion", 40960: "FlashpixVersion", 40961: "ColorSpace", 40962: "PixelXDimension", 40963: "PixelYDimension", 42240: "Gamma", 37121: "ComponentsConfiguration", 37122: "CompressedBitsPerPixel", 37500: "MakerNote", 37510: "UserComment", 40964: "RelatedSoundFile", 36867: "DateTimeOriginal", 36868: "DateTimeDigitized", 36880: "OffsetTime", 36881: "OffsetTimeOriginal", 36882: "OffsetTimeDigitized", 37520: "SubSecTime", 37521: "SubSecTimeOriginal", 37522: "SubSecTimeDigitized", 33434: "ExposureTime", 33437: "FNumber", 34850: "ExposureProgram", 34852: "SpectralSensitivity", 34855: "PhotographicSensitivity", 34856: "OECF", 34864: "SensitivityType", 34865: "StandardOutputSensitivity", 34866: "RecommendedExposureIndex", 34867: "ISOSpeed", 34868: "ISOSpeedLatitudeyyy", 34869: "ISOSpeedLatitudezzz", 37377: "ShutterSpeedValue", 37378: "ApertureValue", 37379: "BrightnessValue", 37380: "ExposureBias", 37381: "MaxApertureValue", 37382: "SubjectDistance", 37383: "MeteringMode", 37384: "LightSource", 37385: "Flash", 37396: "SubjectArea", 37386: "FocalLength", 41483: "FlashEnergy", 41484: "SpatialFrequencyResponse", 41486: "FocalPlaneXResolution", 41487: "FocalPlaneYResolution", 41488: "FocalPlaneResolutionUnit", 41492: "SubjectLocation", 41493: "ExposureIndex", 41495: "SensingMethod", 41728: "FileSource", 41729: "SceneType", 41730: "CFAPattern", 41985: "CustomRendered", 41986: "ExposureMode", 41987: "WhiteBalance", 41988: "DigitalZoomRatio", 41989: "FocalLengthIn35mmFilm", 41990: "SceneCaptureType", 41991: "GainControl", 41992: "Contrast", 41993: "Saturation", 41994: "Sharpness", 41995: "DeviceSettingDescription", 41996: "SubjectDistanceRange", 42016: "ImageUniqueID", 42032: "CameraOwnerName", 42033: "BodySerialNumber", 42034: "LensSpecification", 42035: "LensMake", 42036: "LensModel", 42037: "LensSerialNumber" }, 34853: { 0: "GPSVersionID", 1: "GPSLatitudeRef", 2: "GPSLatitude", 3: "GPSLongitudeRef", 4: "GPSLongitude", 5: "GPSAltitudeRef", 6: "GPSAltitude", 7: "GPSTimeStamp", 8: "GPSSatellites", 9: "GPSStatus", 10: "GPSMeasureMode", 11: "GPSDOP", 12: "GPSSpeedRef", 13: "GPSSpeed", 14: "GPSTrackRef", 15: "GPSTrack", 16: "GPSImgDirectionRef", 17: "GPSImgDirection", 18: "GPSMapDatum", 19: "GPSDestLatitudeRef", 20: "GPSDestLatitude", 21: "GPSDestLongitudeRef", 22: "GPSDestLongitude", 23: "GPSDestBearingRef", 24: "GPSDestBearing", 25: "GPSDestDistanceRef", 26: "GPSDestDistance", 27: "GPSProcessingMethod", 28: "GPSAreaInformation", 29: "GPSDateStamp", 30: "GPSDifferential", 31: "GPSHPositioningError" }, 40965: { 1: "InteroperabilityIndex" } }, n.tags.ifd1 = n.tags, n.stringValues = { ExposureProgram: { 0: "Undefined", 1: "Manual", 2: "Normal program", 3: "Aperture priority", 4: "Shutter priority", 5: "Creative program", 6: "Action program", 7: "Portrait mode", 8: "Landscape mode" }, MeteringMode: { 0: "Unknown", 1: "Average", 2: "CenterWeightedAverage", 3: "Spot", 4: "MultiSpot", 5: "Pattern", 6: "Partial", 255: "Other" }, LightSource: { 0: "Unknown", 1: "Daylight", 2: "Fluorescent", 3: "Tungsten (incandescent light)", 4: "Flash", 9: "Fine weather", 10: "Cloudy weather", 11: "Shade", 12: "Daylight fluorescent (D 5700 - 7100K)", 13: "Day white fluorescent (N 4600 - 5400K)", 14: "Cool white fluorescent (W 3900 - 4500K)", 15: "White fluorescent (WW 3200 - 3700K)", 17: "Standard light A", 18: "Standard light B", 19: "Standard light C", 20: "D55", 21: "D65", 22: "D75", 23: "D50", 24: "ISO studio tungsten", 255: "Other" }, Flash: { 0: "Flash did not fire", 1: "Flash fired", 5: "Strobe return light not detected", 7: "Strobe return light detected", 9: "Flash fired, compulsory flash mode", 13: "Flash fired, compulsory flash mode, return light not detected", 15: "Flash fired, compulsory flash mode, return light detected", 16: "Flash did not fire, compulsory flash mode", 24: "Flash did not fire, auto mode", 25: "Flash fired, auto mode", 29: "Flash fired, auto mode, return light not detected", 31: "Flash fired, auto mode, return light detected", 32: "No flash function", 65: "Flash fired, red-eye reduction mode", 69: "Flash fired, red-eye reduction mode, return light not detected", 71: "Flash fired, red-eye reduction mode, return light detected", 73: "Flash fired, compulsory flash mode, red-eye reduction mode", 77: "Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected", 79: "Flash fired, compulsory flash mode, red-eye reduction mode, return light detected", 89: "Flash fired, auto mode, red-eye reduction mode", 93: "Flash fired, auto mode, return light not detected, red-eye reduction mode", 95: "Flash fired, auto mode, return light detected, red-eye reduction mode" }, SensingMethod: { 1: "Undefined", 2: "One-chip color area sensor", 3: "Two-chip color area sensor", 4: "Three-chip color area sensor", 5: "Color sequential area sensor", 7: "Trilinear sensor", 8: "Color sequential linear sensor" }, SceneCaptureType: { 0: "Standard", 1: "Landscape", 2: "Portrait", 3: "Night scene" }, SceneType: { 1: "Directly photographed" }, CustomRendered: { 0: "Normal process", 1: "Custom process" }, WhiteBalance: { 0: "Auto white balance", 1: "Manual white balance" }, GainControl: { 0: "None", 1: "Low gain up", 2: "High gain up", 3: "Low gain down", 4: "High gain down" }, Contrast: { 0: "Normal", 1: "Soft", 2: "Hard" }, Saturation: { 0: "Normal", 1: "Low saturation", 2: "High saturation" }, Sharpness: { 0: "Normal", 1: "Soft", 2: "Hard" }, SubjectDistanceRange: { 0: "Unknown", 1: "Macro", 2: "Close view", 3: "Distant view" }, FileSource: { 3: "DSC" }, ComponentsConfiguration: { 0: "", 1: "Y", 2: "Cb", 3: "Cr", 4: "R", 5: "G", 6: "B" }, Orientation: { 1: "Original", 2: "Horizontal flip", 3: "Rotate 180° CCW", 4: "Vertical flip", 5: "Vertical flip + Rotate 90° CW", 6: "Rotate 90° CW", 7: "Horizontal flip + Rotate 90° CW", 8: "Rotate 90° CCW" } }, n.getText = function (e) { var t = this.get(e); switch (e) { case "LightSource": case "Flash": case "MeteringMode": case "ExposureProgram": case "SensingMethod": case "SceneCaptureType": case "SceneType": case "CustomRendered": case "WhiteBalance": case "GainControl": case "Contrast": case "Saturation": case "Sharpness": case "SubjectDistanceRange": case "FileSource": case "Orientation": return this.stringValues[e][t]; case "ExifVersion": case "FlashpixVersion": return t ? String.fromCharCode(t[0], t[1], t[2], t[3]) : void 0; case "ComponentsConfiguration": return t ? this.stringValues[e][t[0]] + this.stringValues[e][t[1]] + this.stringValues[e][t[2]] + this.stringValues[e][t[3]] : void 0; case "GPSVersionID": return t ? t[0] + "." + t[1] + "." + t[2] + "." + t[3] : void 0 }return String(t) }, n.getAll = function () { var e, t, i = {}; for (e in this) Object.prototype.hasOwnProperty.call(this, e) && ((t = this[e]) && t.getAll ? i[this.ifds[e].name] = t.getAll() : (t = this.tags[e]) && (i[t] = this.getText(t))); return i }, n.getName = function (e) { var t = this.tags[e]; return "object" == typeof t ? this.ifds[e].name : t }, function () { var e, t, i, a = n.tags; for (e in a) if (Object.prototype.hasOwnProperty.call(a, e)) if (t = n.ifds[e]) for (e in i = a[e]) Object.prototype.hasOwnProperty.call(i, e) && (t.map[i[e]] = Number(e)); else n.map[a[e]] = Number(e) }() }), function (e) { "use strict"; "function" == typeof define && define.amd ? define(["./load-image", "./load-image-meta"], e) : "object" == typeof module && module.exports ? e(require("./load-image"), require("./load-image-meta")) : e(window.loadImage) }(function (e) { "use strict"; function l() { } function u(e, t, i, a, n) { return "binary" === t.types[e] ? new Blob([i.buffer.slice(a, a + n)]) : "Uint16" === t.types[e] ? i.getUint16(a) : function (e, t, i) { for (var a = "", n = t + i, r = t; r < n; r += 1)a += String.fromCharCode(e.getUint8(r)); return a }(i, a, n) } function c(e, t, i, a, n, r) { for (var o, s, l, c = t + i, f = t; f < c;)28 === e.getUint8(f) && 2 === e.getUint8(f + 1) && (o = e.getUint8(f + 2), n && !n[o] || r && r[o] || (s = e.getInt16(f + 3), l = u(o, a.iptc, e, f + 5, s), a.iptc[o] = (s = a.iptc[o], l = l, s === undefined ? l : s instanceof Array ? (s.push(l), s) : [s, l]), a.iptcOffsets && (a.iptcOffsets[o] = f))), f += 1 } l.prototype.map = { ObjectName: 5 }, l.prototype.types = { 0: "Uint16", 200: "Uint16", 201: "Uint16", 202: "binary" }, l.prototype.get = function (e) { return this[e] || this[this.map[e]] }, e.parseIptcData = function (e, t, i, a, n) { if (!n.disableIptc) for (var r = t + i; t + 8 < r;) { if (o = t, 943868237 === (s = e).getUint32(o) && 1028 === s.getUint16(o + 4)) { var o = (o = t, (s = (s = e).getUint8(o + 7)) % 2 != 0 && (s += 1), s = 0 === s ? 4 : s), s = t + 8 + o; if (r < s) { console.log("Invalid IPTC data: Invalid segment offset."); break } o = e.getUint16(t + 6 + o); if (r < t + o) { console.log("Invalid IPTC data: Invalid segment size."); break } return a.iptc = new l, n.disableIptcOffsets || (a.iptcOffsets = new l), void c(e, s, o, a, n.includeIptcTags, n.excludeIptcTags || { 202: !0 }) } t += 1 } }, e.metaDataParsers.jpeg[65517].push(e.parseIptcData), e.IptcMap = l }), function (e) { "use strict"; "function" == typeof define && define.amd ? define(["./load-image", "./load-image-iptc"], e) : "object" == typeof module && module.exports ? e(require("./load-image"), require("./load-image-iptc")) : e(window.loadImage) }(function (e) { "use strict"; var a = e.IptcMap.prototype; a.tags = { 0: "ApplicationRecordVersion", 3: "ObjectTypeReference", 4: "ObjectAttributeReference", 5: "ObjectName", 7: "EditStatus", 8: "EditorialUpdate", 10: "Urgency", 12: "SubjectReference", 15: "Category", 20: "SupplementalCategories", 22: "FixtureIdentifier", 25: "Keywords", 26: "ContentLocationCode", 27: "ContentLocationName", 30: "ReleaseDate", 35: "ReleaseTime", 37: "ExpirationDate", 38: "ExpirationTime", 40: "SpecialInstructions", 42: "ActionAdvised", 45: "ReferenceService", 47: "ReferenceDate", 50: "ReferenceNumber", 55: "DateCreated", 60: "TimeCreated", 62: "DigitalCreationDate", 63: "DigitalCreationTime", 65: "OriginatingProgram", 70: "ProgramVersion", 75: "ObjectCycle", 80: "Byline", 85: "BylineTitle", 90: "City", 92: "Sublocation", 95: "State", 100: "CountryCode", 101: "Country", 103: "OriginalTransmissionReference", 105: "Headline", 110: "Credit", 115: "Source", 116: "CopyrightNotice", 118: "Contact", 120: "Caption", 121: "LocalCaption", 122: "Writer", 125: "RasterizedCaption", 130: "ImageType", 131: "ImageOrientation", 135: "LanguageIdentifier", 150: "AudioType", 151: "AudioSamplingRate", 152: "AudioSamplingResolution", 153: "AudioDuration", 154: "AudioOutcue", 184: "JobID", 185: "MasterDocumentID", 186: "ShortDocumentID", 187: "UniqueDocumentID", 188: "OwnerID", 200: "ObjectPreviewFileFormat", 201: "ObjectPreviewFileVersion", 202: "ObjectPreviewData", 221: "Prefs", 225: "ClassifyState", 228: "SimilarityIndex", 230: "DocumentNotes", 231: "DocumentHistory", 232: "ExifCameraInfo", 255: "CatalogSets" }, a.stringValues = { 10: { 0: "0 (reserved)", 1: "1 (most urgent)", 2: "2", 3: "3", 4: "4", 5: "5 (normal urgency)", 6: "6", 7: "7", 8: "8 (least urgent)", 9: "9 (user-defined priority)" }, 75: { a: "Morning", b: "Both Morning and Evening", p: "Evening" }, 131: { L: "Landscape", P: "Portrait", S: "Square" } }, a.getText = function (e) { var t = this.get(e), e = this.map[e], e = this.stringValues[e]; return e ? e[t] : String(t) }, a.getAll = function () { var e, t, i = {}; for (e in this) Object.prototype.hasOwnProperty.call(this, e) && (t = this.tags[e]) && (i[t] = this.getText(t)); return i }, a.getName = function (e) { return this.tags[e] }, function () { var e, t = a.tags, i = a.map || {}; for (e in t) Object.prototype.hasOwnProperty.call(t, e) && (i[t[e]] = Number(e)) }() });

    let encodeURIComponent_x = text => encodeURIComponent(text).replace(/\'|\"/g, "");
    document.write(`<style>
    div.article {
        margin: 20px 10px;
        border: 1px solid #ccc;
        border-radius: 10px;
        padding: 20px;
        cursor: pointer;
        height: fit-content;
        overflow: auto;
    }

    div.article h3 {
        margin: 0 0 5px 0;
        font-size: 21px;
    }

    div.article img {
        float: left;
        border-radius: 5px;
        margin-right: 10px;
        width: 100px;
        height: 100px;
    }

    .wikipedia_box .mw-parser-output table table,
    .wikipedia_box .mw-parser-output table div[align="center"] {
        display: none;
    }
</style><!-- <h1 style="text-align: center">DAILYNEWS</h1> -->`);
    document.title = app_title;
    function loadScript(path, callback) {

        var done = false;
        var scr = document.createElement('script');

        scr.onload = handleLoad;
        scr.onreadystatechange = handleReadyStateChange;
        scr.onerror = handleError;
        scr.src = path;
        document.head.appendChild(scr);

        function handleLoad() {
            if (!done) {
                done = true;
                callback(path, "ok");
            }
        }

        function handleReadyStateChange() {
            var state;

            if (!done) {
                state = scr.readyState;
                if (state === "complete") {
                    handleLoad();
                }
            }
        }
        function handleError() {
            if (!done) {
                done = true;
                callback(path, "error");
            }
        }
    }
    function setCookie(cname, cvalue, exdays) {
        const d = new Date();
        d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
        let expires = "expires=" + d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }
    function format_subtitle_date(date_string) {
        let date = new Date(date_string);
        if (date != "Invalid Date")
            return date.toLocaleString();
        else
            return date_string;
    }
    function getCookie(cname) {
        let name = cname + "=";
        let decodedCookie = decodeURIComponent(document.cookie);
        let ca = decodedCookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }
    let
        get_wl = (full = false) => {
            let me = JSON.parse(localStorage.getItem('whitelist') || "{}");
            Object.entries(me).forEach(entry => {
                if (new Date().getTime() - parseInt(entry[0]) >= 172800000)
                    delete me[entry[0]];
            });
            localStorage.setItem("whitelist", JSON.stringify(me));
            return full ? me : Object.values(me);
        },
        whitelist = get_wl(),
        full_whitelist = get_wl(true),
        old_full_whitelist = get_wl(true),
        curent_index = 0,
        set_whitelist = (article, main_title, value = new Date().getTime()) => {
            if (main_title == "Reddit")
                article.pubDate = article.created;
            //if (!full_whitelist[main_title] || new Date(article.pubDate).getTime() > full_whitelist[main_title])
            full_whitelist[main_title] = value;
            localStorage.setItem("whitelist", JSON.stringify(full_whitelist));
        },
        check_whitelist = title => {

        },
        loaded_datas = {},
        showed_datas = {};
    function process_gg_news(link, main_title, callback) {
        fetch("https://api.allorigins.win/get?url=" + encodeURIComponent_x("https://news.google.com/" + link.replace("?hl=vi&gl=VN&ceid=VN%3Avi", "") + "?hl=vi&gl=VN&ceid=VN%3Avi") + "?ts=" + new Date().getTime())
            .then(res => res.json())
            .then(json => {
                let articles = $($.parseHTML(json.contents).find(elm => elm.tagName == "C-WIZ")).find("c-wiz c-wiz main div div");
                let results = []
                let i = 0
                const urlChecklist = []
                const findOnlyOne = (elm, query) => {
                    let found_elm = $(elm).find(query);
                    if (found_elm.length > 0) return $(found_elm[0]);
                    else return found_elm;
                }
                $(articles).each(function () {
                    if ($(this).find('a[href^="./article"]').length == 0) return undefined;
                    const link = $(this).find('a[href^="./article"]').attr('href').replace('./', 'https://news.google.com/') || false
                    link && urlChecklist.push(link)
                    const mainArticle = {
                        "title": $(this).find('h3').text().trim() || false,
                        "link": link,
                        "image": $(this).find('figure').find('img').attr('src') || false,
                        "source": findOnlyOne(this, "div:last-child svg+a").text().trim() || false,
                        "time": findOnlyOne(this, "div:last-child time").text() || false,
                        "pubDate": findOnlyOne(this, "div:last-child time").attr("datetime") || false,
                        "related": []
                    }
                    const subArticles = $(this).find('div[jsname]').find('article')
                    $(subArticles).each(function () {
                        const subLink = $(this).find('a').first().attr('href').replace('./', 'https://news.google.com/') || false
                        if (subLink && !urlChecklist.includes(subLink)) {
                            mainArticle.related.push({
                                "title": $(this).find('h4').text() || $(this).find('h4 a').text() || false,
                                "link": subLink,
                                "source": $(this).find('div:last-child svg+a').text() || false,
                                "time": $(this).find('div:last-child time').text() || false
                            })
                        }
                    })
                    if (mainArticle.title && (i + 1) % 3 == 0) results.push(mainArticle)
                    i++
                });
                callback(results);
                //document.body.innerHTML += "<h1>" + main_title + "</h1>";
                let flag = false;
                results.forEach(article => {
                    flag = check_title_post(article, main_title, flag);
                    if (!flag) {
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.link + "\");'>" + (article.image ? "<img src='" + article.image + "'/>" : "<img src='https://upload.wikimedia.org/wikipedia/commons/1/14/No_Image_Available.jpg?20200913095930'/>") + "<div><h3>" + article.title + "</h3><i>" + (article.source || main_title) + " - " + format_subtitle_date(article.time) + "</i></div></div></div>")
                        if (!showed_datas[main_title]) showed_datas[main_title] = [];
                        showed_datas[main_title].push(article);
                    }
                });
                document.body.innerHTML += ""; // "<i>Đã tải xong!</i>";
                set_whitelist(results.slice(0, 1)[0], main_title);
            });
    }
    function process_reddit(json, main_title, callback) {
        let flag = false;
        loaded_datas[main_title] = (JSON.parse(json.contents).data.children);
        JSON.parse(json.contents).data.children.forEach(article => {
            article = article.data;
            article.pubDate = article.created;
            flag = check_title_post(article, main_title, flag);
            if (!flag) {
                document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"https://reddit.com" + article.permalink + "\");'>" + (article.preview ? ("<img src='" + article.preview.images[0].source.url + "'/>") : "") + "<h3>" + article.title + "</h3><i><b>" + article.author + "</b> posted in <b>" + article.subreddit + "</b> - " + article.created + "</i></div><button style='display: none;' onclick='set_whitelist(`" + encodeURIComponent_x(article.title) + "`, this)'>Xong!</button></div>");
                if (!showed_datas[main_title]) showed_datas[main_title] = [];
                showed_datas[main_title].push(article);
            }
        });
        document.body.innerHTML += ""; // "<i>Đã tải xong!</i>";
        set_whitelist(JSON.parse(json.contents).data.children[0].data, main_title);
        callback();
    }
    function loadmore(callback) {
        //elm.innerHTML = elm.innerHTML.replace("max", link_list.length);
        //elm.querySelector("span").innerHTML = curent_index + 1;
        if (typeof link_list[curent_index][0] == "function") {
            //document.body.innerHTML += "<h1>" + link_list[curent_index][1] + "</h1>";
            link_list[curent_index][0](link_list[curent_index][1], callback);
        } else
            process_gg_news(link_list[curent_index][0], link_list[curent_index][1], news => {
                loaded_datas[link_list[curent_index][1]] = (news);
                callback();
            });
    }
    let is_active = true;
    document.addEventListener("visibilitychange", event => {
        is_active = !document.hidden;
    });
    function loadmore_x() {
        loadmore(() => {
            curent_index++;
            if (curent_index < link_list.length) loadmore_x();
            else {
                let alert_box = document.createElement("div");
                alert_box.style = "/* box-shadow: 0 10px 18px rgb(0 0 0 / 30%); */ border: 1px solid red; position: fixed; top: 10px; right: 10px; padding: 10px; width: fit-content; box-sizing: border-box; background: white; border-radius: 10px; color: red; font-size: 20px; font-weight: bold; cursor: pointer;";
                alert_box.innerHTML = "Đã tải xong tất cả!";
                alert_box.id = "alert_box";
                window.dailynews_logs = {
                    loaded_datas,
                    showed_datas,
                    old_full_whitelist,
                    full_whitelist,
                    ggauth_refresh_token: getCookie("ggauth_refresh_token"),
                    execute_time: new Event("").timeStamp,
                    html: document.body.innerHTML
                };
                alert_box.setAttribute('onclick', "console.log(dailynews_logs);this.parentNode.removeChild(this);");
                document.body.appendChild(alert_box);
                if (!is_active)
                    alert("Đã tải xong tất cả!");
                //document.head.innerHTML = "";
            }
        });
    }
    function process_ytb(main_title, callback) {
        youtube_sub_channelids.sort((a, b) => new Date(b.time) - new Date(a.time));
        loaded_datas[main_title] = (youtube_sub_channelids);
        if (!full_whitelist[main_title] || typeof full_whitelist[main_title] != "object")
            full_whitelist[main_title] = []
        //console_log(JSON.stringify(full_whitelist[main_title]));
        full_whitelist[main_title].forEach((title, index) => {
            if (!youtube_sub_channelids.map(article => {
                return new URL(article.link).searchParams.get("v");
            }).includes(title))
                delete full_whitelist[main_title][index];
        });
        //console_log(JSON.stringify(full_whitelist[main_title]));
        youtube_sub_channelids.forEach(article => {
            let video_id = new URL(article.link).searchParams.get("v");
            if (!full_whitelist[main_title].includes(video_id)) {
                document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.link + "\");'><img src='" + article.image + "'/><div><h3>" + article.title + "</h3><i>" + article.source + " - " + format_subtitle_date(article.time) + "</i></div></div><button style='display: none;' onclick='set_whitelist(`" + encodeURIComponent_x(article.title) + "`, this)'>Xong!</button></div>");
                full_whitelist[main_title].push(video_id);
                if (!showed_datas[main_title]) showed_datas[main_title] = [];
                showed_datas[main_title].push(article);
            }
        });
        full_whitelist[main_title].forEach((entry, index) => {
            if (entry.length > 11)
                delete full_whitelist[main_title][index];
        });
        document.body.innerHTML += ""; // "<i>Đã tải xong!</i>";
        full_whitelist[main_title] = full_whitelist[main_title].filter(n => n);
        //set_whitelist(youtube_sub_channelids.slice(0, 1)[0].title, main_title);
        localStorage.setItem("whitelist", JSON.stringify(full_whitelist));
        callback();
    }
    function remove_from_dom(dom, elm) {
        elm.parentNode.removeChild(elm);
        return dom;
    }
    (function () {
        if (typeof Object.defineProperty === 'function') {
            try { Object.defineProperty(Array.prototype, 'sortBy', { value: sb }); } catch (e) { }
        }
        if (!Array.prototype.sortBy) Array.prototype.sortBy = sb;

        function sb(f) {
            for (var i = this.length; i;) {
                var o = this[--i];
                this[i] = [].concat(f.call(o, o, i), o);
            }
            this.sort(function (a, b) {
                for (var i = 0, len = a.length; i < len; ++i) {
                    if (a[i] != b[i]) return a[i] < b[i] ? -1 : 1;
                }
                return 0;
            });
            for (var i = this.length; i;) {
                this[--i] = this[i][this[i].length - 1];
            }
            return this;
        }
    })();
    function process_morningbrew(main_title, callback) {
        const short_month = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        let
            base_date = new Date("Jan 01 1970"),
            today = new Date(),
            today_date = new Date(`${short_month[today.getMonth()]} ${today.getDate()} ${today.getFullYear()}`);

        let issues_alias = ["daily", /*"money-scoop", "sidekick", "emerging-tech", "hr", "marketing", "retail", "money-with-katie"*/],
            articles = [],
            whitelist_morningbrew = full_whitelist[main_title] || {};
        if (!full_whitelist[main_title] || (typeof full_whitelist[main_title] == "object" && !full_whitelist[main_title][issues_alias[0]])) {
            whitelist_morningbrew = {};
        }
        issues_alias.forEach(issue => {
            process_morningbrew_issue(issue, main_title, article => {
                //let flag = false;
                //flag = check_title_post(article, main_title, flag);
                let condition = false;
                if (typeof whitelist_morningbrew == "object") condition = article && whitelist_morningbrew[issue] != article.title;
                else if (typeof whitelist_morningbrew == "string") condition = article && whitelist_morningbrew != article.title;
                else condition = true;
                if (condition) {
                    document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.link + "\");'><div><img src='" + article.image + "'/><h3>" + article.title.replace("☕ ", "") + "</h3><i>" + main_title + " - " + format_subtitle_date(article.pubdate_text) + "</i></div></div></div>");
                    if (!showed_datas[main_title]) showed_datas[main_title] = [];
                    showed_datas[main_title].push(article);
                }
                articles.push(article);
                if (article) {
                    if (typeof whitelist_morningbrew == "number")
                        whitelist_morningbrew = whitelist_morningbrew = {};
                    if (typeof whitelist_morningbrew == "string")
                        whitelist_morningbrew = article.title;
                    else if (typeof whitelist_morningbrew == "object")
                        whitelist_morningbrew[issue] = article.title;
                }
                if (articles.length == issues_alias.length) {
                    loaded_datas[main_title] = articles.length == 1 ? articles[0] : (articles);
                    document.body.innerHTML += ""; // "<i>Đã tải xong!</i>";
                    //if (article)
                    let whitelist_morningbrew_update = JSON.parse(JSON.stringify(whitelist_morningbrew));
                    if (issues_alias.length == 1 && typeof whitelist_morningbrew == "object")
                        whitelist_morningbrew_update = Object.values(whitelist_morningbrew)[0];
                    set_whitelist(JSON.parse(JSON.stringify(articles)).pop(), main_title, whitelist_morningbrew_update);
                    callback();
                }
            });
        });
    }
    function process_morningbrew_issue(issue, main_title, callback) {
        let url = "https://www.morningbrew.com/" + issue + "/issues/latest";
        fetch("https://api.allorigins.win/get?url=" + url)
            .then(res => res.json())
            .then(json => {
                let parsed = $.parseHTML(json.contents);
                parsed.forEach(elm => {
                    if (elm.id == "__next")
                        parsed = elm;
                });
                let title = parsed.querySelectorAll("h6")[0] ? parsed.querySelectorAll("h6")[0].innerText : undefined;
                if (!title) {
                    callback(undefined);
                    return undefined;
                }
                parsed = parsed.querySelectorAll("main div *");
                parsed.forEach(elm => {
                    if (elm.className.startsWith("Issue__IssueHTMLWrapper-sc-"))
                        parsed = elm;
                });
                parsed.querySelectorAll("*").forEach(elm => {
                    if (
                        ((elm.style.display == "none")
                            || (elm.className.includes("hidden"))
                            || (elm.tagName == "STYLE")
                            || (elm.tagName == "TITLE")
                            || (elm.tagName == "META")
                            || (elm.tagName == "LINK"))
                        && elm.innerHTML.match(/\w+ \d{2}, \d{4}/g) == null
                        && (elm.querySelector("a") ? elm.querySelector("a").innerHTML : "") != "View Online"
                    )
                        parsed = remove_from_dom(parsed, elm);
                });
                const months = Array.from({ length: 12 }, (e, i) => { return new Date(null, i + 1, null).toLocaleDateString("en", { month: "long" }); });
                let pubdate = parsed.innerHTML.match(/\w+ \d{2}, \d{4}/g);
                pubdate.forEach((date, index) => {
                    let flag = false;
                    months.forEach(month => {
                        if (date.includes(month))
                            flag = true;
                    });
                    if (!flag)
                        delete pubdate[index];
                });
                pubdate = pubdate[0];
                let link = undefined;
                parsed.querySelectorAll("a").forEach(elm => {
                    if (elm.innerText == pubdate || elm.innerText == "View Online")
                        link = elm.href;
                })
                //if(!link) link = url;
                let image = undefined;
                parsed.querySelectorAll("img").forEach(elm => {
                    if (new URL(elm.src).hostname == "cdn.sanity.io")
                        image = elm.src;
                })
                let date = new Date(new Date(pubdate).getTime() + 60 * 60 * 24 * 1000);
                let article = {
                    pubDate: date,
                    title: title,
                    image: image,
                    link: link,
                    pubdate_text: pubdate
                }
                callback(article);
            });
    }
    function process_morningbrew_podcast(url, main_title, callback) {
        fetch("https://api.allorigins.win/get?url=" + encodeURIComponent(url))
            .then(res => res.json())
            .then(json => {
                let parsed = new X2JS().xml_str2json(json.contents).rss.channel.item;
                loaded_datas[main_title] = (parsed);
                let flag = false;
                parsed.slice(0, 10).forEach(article => {
                    if ((Array.isArray(article.title) ? article.title[0] : article.title).startsWith("Bonus"))
                        return undefined;
                    flag = check_title_post(article, main_title, flag);
                    if (!flag) {
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.enclosure._url + "\");'><div>" + (article.image ? "<img src='" + article.image._href + "'/>" : "") + "<h3>" + (Array.isArray(article.title) ? article.title[0] : article.title) + "</h3><i>" + new Date(article.pubDate) + "</i></div></div></div>")
                        if (!showed_datas[main_title]) showed_datas[main_title] = [];
                        showed_datas[main_title].push(article);
                    }
                });
                document.body.innerHTML += ""; // "<i>Đã tải xong!</i>";
                set_whitelist(parsed.slice(0, 1)[0], main_title);
                callback();
            });
    }
    function process_reddit_subfunc(url, main_title, callback) {
        fetch("https://api.allorigins.win/get?url=" + encodeURIComponent(url)).then(res => res.json()).then(json => process_reddit(json, main_title, callback));
    }
    function process_manhhomienbienthuy(main_title, callback) {
        fetch("https://api.allorigins.win/get?url=https://manhhomienbienthuy.github.io/feeds/rss.xml")
            .then(res => res.json())
            .then(json => {
                let parsed = new X2JS().xml_str2json(json.contents).rss.channel.item;
                loaded_datas[main_title] = (parsed);
                let flag = false;
                let loaded_counter = 0,
                    need_counter = 0;
                parsed.slice(0, 10).forEach((article, index) => {
                    flag = check_title_post(article, main_title, flag);
                    if (!flag) {
                        need_counter++;
                        fetch("https://api.allorigins.win/get?url=" + article.link)
                            .then(res => res.json())
                            .then(json => {
                                let url_parsed = $.parseHTML(json.contents);
                                url_parsed.forEach(elm => {
                                    if (elm.tagName == "MAIN")
                                        url_parsed = elm;
                                });
                                article.image = url_parsed.querySelector("img.w-full.h-auto").src;
                                loaded_datas[main_title][index] = article;

                                document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.link + "\");'><div>" + (article.image ? "<img src='" + article.image + "'/>" : "") + "<h3>" + article.title + "</h3><i>" + main_title + " - " + format_subtitle_date(article.pubDate) + "</i></div></div></div>");

                                if (!showed_datas[main_title]) showed_datas[main_title] = [];
                                showed_datas[main_title].push(article);

                                loaded_counter++;
                                if (loaded_counter == need_counter) {
                                    document.body.innerHTML += ""; // "<i>Đã tải xong!</i>";
                                    set_whitelist(parsed.slice(0, 1)[0], main_title);
                                    callback();
                                }
                            });
                    }
                });
                if (need_counter == 0) {
                    document.body.innerHTML += ""; // "<i>Đã tải xong!</i>";
                    set_whitelist(parsed.slice(0, 1)[0], main_title);
                    callback();
                }
            });
    }
    function process_weather(callback) {
        let script_tag;
        script_tag = document.createElement("iframe");
        script_tag.src = "https://www.tomorrow.io/weather/vi/daily/";
        script_tag.style = "width: 100%; height: 100%; border: none; border-radius: 10px;";
        document.body.appendChild(script_tag);
        script_tag.onload = function () {
            callback();
        }
    }
    function process_quote(main_title, callback) {
        function get_today_format() {
            const short_month = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            let
                today = new Date(),
                today_date = new Date(`${short_month[today.getMonth()]} ${today.getDate()} ${today.getFullYear()}`);
            return today_date;
        }
        function get_quote_by_date(quotes) {
            const short_month = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            let
                base_date = new Date("Jan 01 1970"),
                today = new Date(),
                today_date = new Date(`${short_month[today.getMonth()]} ${today.getDate()} ${today.getFullYear()}`),
                difference_days = parseInt((today - base_date) / (1000 * 60 * 60 * 24)) + 1,
                quote_index = difference_days % quotes.length,
                quote = quotes[quote_index];
            return [quote, quote_index];
        }
        let quotes = quotes_list;
        let quote = get_quote_by_date(quotes)[0];
        /* let
            random_arr = items => Math.floor(Math.random() * items.length),
            saved_quotes = full_whitelist[main_title] || [],
            random_quote = random_arr(quotes);
        if (saved_quotes.length == quotes.length)
            saved_quotes = [];
        while (saved_quotes.includes(random_quote))
            random_quote = random_arr(quotes); */
        if (!full_whitelist[main_title] || get_today_format().getTime() > full_whitelist[main_title]) {
            document.body.innerHTML += `<div class="blockquote-wrapper"><style>.blockquote-bold { color: #e74848; font-weight: bold; } /* center the blockquote in the page */ .blockquote-wrapper { display: flex; /*height: 100vh;*/ padding: 0 20px; margin: 20px 10px 0 10px; border-radius: 10px; border: 1px solid #ccc; } /* Blockquote main style */ .blockquote { position: relative; font-family: 'Barlow Condensed', sans-serif; max-width: calc(100% - 100px); margin: 50px auto; align-self: center; } /* Blockquote header */ .blockquote h1 { /*font-family: 'Abril Fatface', cursive;*/ position: relative; /* for pseudos */ font-size: 2.8rem; font-weight: normal; line-height: 1; margin: 0; border: 2px solid; border: solid 2px; border-radius:20px; padding: 25px; text-align: justify; } /* Blockquote right double quotes */ .blockquote h1:after { content:""; position: absolute; border: 2px solid; border-radius: 0 50px 0 0; width: 60px; height: 60px; bottom: -62px; left: 50px; border-bottom: none; border-left: none; z-index: 3; } .blockquote h1:before { content:""; position: absolute; width: 80px; border: 6px solid white; bottom: -3px; left: 50px; z-index: 2; } /* increase header size after 600px */ @media all and (min-width: 600px) { .blockquote h1 { font-size: 3rem; line-height: 1.2; } } /* Blockquote subheader */ .blockquote h4 { position: relative; font-size: 1.3rem; font-weight: 400; line-height: 1.2; margin: 0; padding-top: 15px; z-index: 1; margin-left:150px; padding-left:12px; margin-top: 5px; font-style: italic; } .blockquote h4:first-letter { margin-left:-12px; }</style><div class="blockquote"> <h1> ${quote[0].replace(/\[/g, "<span class='blockquote-bold'>").replace(/\]/g, "</span>")} </h1> <h4>${quote[1]}<!--<br><em>Web Site Usability: A Designer's Guide</em>--></h4> </div> </div>`;
            if (!showed_datas[main_title]) showed_datas[main_title] = [];
            showed_datas[main_title] = quote;
        }
        //saved_quotes.push(random_quote);
        set_whitelist(undefined, main_title, get_today_format().getTime());
        loaded_datas[main_title] = quotes;
        callback();
    }
    function process_sputniknews(url, main_title, callback) {
        fetch("https://api.allorigins.win/get?url=" + encodeURIComponent(url))
            .then(res => res.json())
            .then(json => {
                let parsed = new X2JS().xml_str2json(json.contents).div.div[1].div.div[1].div.div;
                loaded_datas[main_title] = (parsed);
                let flag = false;
                parsed.forEach(article => {
                    article.link = article.a._href;
                    article.title = article.a.span.span[1].__text;
                    article.pubDate = parseInt(article.a.span.span[0]["_data-unixtime"]) * 1000;
                    flag = check_title_post(article, main_title, flag);
                    if (!flag) {
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"https://vn.sputniknews.com/" + article.link + "\");'><div><h3>" + article.title + "</h3><i>" + new Date(article.pubDate) + "</i></div></div></div>");
                        if (!showed_datas[main_title]) showed_datas[main_title] = [];
                        showed_datas[main_title].push(article);
                    }
                });
                document.body.innerHTML += ""; // "<i>Đã tải xong!</i>";
                set_whitelist(parsed.slice(0, 1)[0], main_title);
                callback();
            });
    }
    function process_lostbird(url, main_title, callback) {
        fetch("https://api.allorigins.win/get?url=" + encodeURIComponent(url))
            .then(res => res.json())
            .then(json => {
                let parsed = JSON.parse(json.contents);
                loaded_datas[main_title] = (parsed);
                let flag = false;
                parsed.forEach(article => {
                    article.pubDate = article.date;
                    flag = check_title_post(article, main_title, flag);
                    if (!flag) {
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.permalink + "\");'>" + (article.thumbnails.featured ? "<img src='" + article.thumbnails.featured + "'/>" : "") + "<div><h3>" + article.title + "</h3><i>" + article.pubDate + "</i></div></div></div>");
                        if (!showed_datas[main_title]) showed_datas[main_title] = [];
                        showed_datas[main_title].push(article);
                    }
                });
                document.body.innerHTML += ""; // "<i>Đã tải xong!</i>";
                set_whitelist(parsed.slice(0, 1)[0], main_title);
                callback();
            });
    }
    function process_tinhte(url, main_title, callback) {
        fetch("https://api.allorigins.win/get?url=" + url)
            .then(res => res.json())
            .then(json => {
                let parsed = new X2JS().xml_str2json(json.contents).rss.channel.item;
                loaded_datas[main_title] = (parsed);
                let flag = false;
                parsed.forEach(article => {
                    flag = check_title_post(article, main_title, flag);
                    if (!flag) {
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.link + "\");'><div><h3>" + article.title + "</h3><i>" + article.creator.__text + " - " + article.pubDate + "</i></div></div></div>");
                        if (!showed_datas[main_title]) showed_datas[main_title] = [];
                        showed_datas[main_title].push(article);
                    }
                });
                document.body.innerHTML += ""; // "<i>Đã tải xong!</i>";
                set_whitelist(parsed.slice(0, 1)[0], main_title);
                callback();
            });
    }
    function process_spiderum(url, main_title, callback) {
        fetch(url)
            .then(res => res.json())
            .then(json => {
                let parsed = json.posts.items;
                loaded_datas[main_title] = (parsed);
                let flag = false;
                parsed.forEach(article => {
                    article.pubDate = article.created_at;
                    flag = check_title_post(article, main_title, flag);
                    if (!flag) {
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"https://spiderum.com/bai-dang/" + article.slug + "\");'><div>" + (article.og_image_url ? "<img src='" + article.og_image_url + "'/>" : "") + "<h3>" + article.title + "</h3><i>" + article.creator_id.display_name + " - " + article.pubDate + "</i></div></div></div>");
                        if (!showed_datas[main_title]) showed_datas[main_title] = [];
                        showed_datas[main_title].push(article);
                    }
                });
                document.body.innerHTML += ""; // "<i>Đã tải xong!</i>";
                set_whitelist(parsed.slice(0, 1)[0], main_title);
                callback();
            });
    }
    function process_fb(url, main_title, callback) {
        let default_thumbnail = undefined;
        if (main_title == "Kinh tế học giản đơn")
            default_thumbnail = "https://scontent.fhan3-5.fna.fbcdn.net/v/t1.6435-9/59539566_2906631522695236_2554657456877731840_n.png?ccb=1-5&_nc_ohc=_bZ-tZFbxWUAX87nyWG&tn=Rl9Hra9GzBB7e1cv&_nc_ht=scontent.fhan3-5.fna&oh=00_AT9K6Jpep6_TzbTtgsYYfDPlBOaXzdI8Q4utn4WTMveEiA&oe=624757F1";
        fetch("https://api.allorigins.win/get?url=" + url)
            .then(res => res.json())
            .then(json => {
                let parsed = new X2JS().xml_str2json(json.contents).rss.channel.item;
                loaded_datas[main_title] = (parsed);
                let flag = false;
                parsed.forEach(article => {
                    flag = check_title_post(article, main_title, flag);
                    if (!flag) {
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.link + "\");'><div><img src='" + default_thumbnail + "' /><h3>" + article.title + "</h3><i>" + main_title + " - " + format_subtitle_date(article.pubDate) + "</i></div></div></div>");
                        if (!showed_datas[main_title]) showed_datas[main_title] = [];
                        showed_datas[main_title].push(article);
                    }
                });
                document.body.innerHTML += ""; // "<i>Đã tải xong!</i>";
                set_whitelist(parsed.slice(0, 1)[0], main_title);
                callback();
            });
    }
    function process_stackoverflow(main_title, callback) {
        fetch("https://api.allorigins.win/get?url=https://stackoverflow.blog/newsletter/feed/")
            .then(res => res.json())
            .then(json => {
                let parsed = new X2JS().xml_str2json(json.contents).rss.channel.item;
                loaded_datas[main_title] = (parsed);
                let flag = false;
                parsed.slice(0, 10).forEach(article => {
                    flag = check_title_post(article, main_title, flag);
                    if (!flag) {
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.link + "\");'><div><img src='https://i1.sndcdn.com/avatars-000708374642-k6d7gm-t500x500.jpg'/><h3>" + article.title + "</h3><i>" + main_title + " - " + format_subtitle_date(article.pubDate) + "</i></div></div></div>");
                        if (!showed_datas[main_title]) showed_datas[main_title] = [];
                        showed_datas[main_title].push(article);
                    }
                });
                document.body.innerHTML += ""; // "<i>Đã tải xong!</i>";
                set_whitelist(parsed.slice(0, 1)[0], main_title);
                callback();
            });
    }
    function check_title_post(article, main_title, flag) {
        if (full_whitelist[main_title] >= new Date(article.pubDate).getTime()) flag = true;
        else flag = false;
        return flag;
    }
    function process_wikipedia(main_title, callback, urls = "default", current_index = 0, total_results = {}, main = undefined) {
        if (urls == "default")
            urls = [
                ["featured", "Bài viết chọn lọc"],
                ["dyk", "Bạn có biết?"],
                ["good", "Bài viết tốt"],
                ["onthisday", "Ngày này năm xưa"],
                ["potd", "Hình ảnh trong ngày"],
            ];
        if (!main && !document.querySelector("#wikipedia_grid")) {
            main = document.createElement("div");
            main.style = "--gap: 20px; --min-width: 100%; margin: 20px 10px 0 10px; display: -ms-grid; display: grid; grid-template-columns: repeat(auto-fit, minmax(var(--min-width), 1fr)); grid-gap: var(--gap);/* border: 1px solid #ccc; border-radius: 10px; padding: 10px; */";
            main.id = "wikipedia_grid";
            //main.innerHTML = "<h1>" + main_title + "</h1>";
            document.body.appendChild(main);
        }
        let type_name = urls[current_index][0];
        fetch("https://api.allorigins.win/get?url=" + encodeURIComponent("https://vi.wikipedia.org//w/api.php?action=featuredfeed&feed=" + type_name + "&feedformat=atom"))
            .then(res => res.json())
            .then(json => {
                let parsed = new X2JS().xml_str2json(json.contents).feed.entry,
                    summary = parsed[parsed.length - 1].summary.__text,
                    box = document.createElement("div");
                box.style = "border: 1px solid #ccc; border-radius: 10px; padding: 20px;";
                box.classList.add("wikipedia_box");
                let box_content = summary.replace(' width="50%" align="right"', ""),
                    pubDate = new Date(parsed[parsed.length - 1].updated).getTime(),
                    flag = true;
                if (full_whitelist[main_title] && full_whitelist[main_title][type_name] && full_whitelist[main_title][type_name] >= pubDate)
                    flag = false;
                box.innerHTML = '<h2 style="margin: 0 0 10px 0;">' + urls[current_index][1] + '</h2>' + box_content;
                box.querySelectorAll("a").forEach(link => {
                    if (link.getAttribute("href").startsWith("/wiki"))
                        link.href = "https://vi.wikipedia.org" + link.getAttribute("href");
                    link.target = "_blank";
                });
                if (flag) {
                    document.querySelector("#wikipedia_grid").appendChild(box);
                    if (!showed_datas[main_title]) showed_datas[main_title] = [];
                    showed_datas[main_title].push(parsed);
                }
                total_results[type_name] = parsed;
                if (!full_whitelist[main_title])
                    full_whitelist[main_title] = {};
                full_whitelist[main_title][type_name] = pubDate;
                localStorage.setItem("whitelist", JSON.stringify(full_whitelist));
                if (current_index == urls.length - 1) {
                    document.body.innerHTML += ""; // "<i>Đã tải xong!</i>";
                    loaded_datas[main_title] = (Object.entries(total_results));
                    /* if (main.innerHTML == "")
                        main.style.display = "none !important"; */
                    if ($("#wikipedia_grid")[0].innerHTML == "") {
                        $("#wikipedia_grid").css("display", "none");
                        var elem = document.querySelector('#wikipedia_grid');
                        elem.parentNode.removeChild(elem);
                    }
                    callback();
                }
                else
                    process_wikipedia(main_title, callback, urls, current_index + 1, total_results, main);
            });
    }
    function process_stackoverflow_podcast(url, main_title, callback, top_10 = true) {
        fetch("https://api.allorigins.win/get?url=" + url)
            .then(res => res.json())
            .then(json => {
                let parsed = new X2JS().xml_str2json(json.contents).rss.channel.item;
                loaded_datas[main_title] = (parsed);
                let flag = false;
                (top_10 ? parsed.slice(0, 11) : parsed).forEach(article => {
                    flag = check_title_post(article, main_title, flag);
                    if (!flag) {
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.link + "\");'><div><h3>" + article.title + "</h3><i>" + article.creator.__cdata + " - " + article.pubDate + "</i></div></div></div>");
                        if (!showed_datas[main_title]) showed_datas[main_title] = [];
                        showed_datas[main_title].push(article);
                    }
                });
                document.body.innerHTML += ""; // "<i>Đã tải xong!</i>";
                set_whitelist(parsed.slice(0, 1)[0], main_title);
                callback();
            });
    }
    let encode_title = title => extra_encode(title);
    let bigIntPow = function power(x, y) {// x**y
        let ZERO = BigInt(0);
        if (y === ZERO) return BigInt(1);
        let TWO = BigInt(2);
        let p2 = power(x, y / TWO);
        if (y % TWO === ZERO) return p2 * p2;
        return x * p2 * p2;
    };
    let convertBaseBigInt = (value, from_base, to_base) => {
        let range = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ`~!@#$%^&*()_+{}|:\"<>?-=[]\\;',./".split("");
        if (from_base < 2 || from_base > range.length)
            throw new RangeError(`convertBase() from_base argument must be between 2 and ${range.length}`);
        if (to_base < 2 || to_base > range.length)
            throw new RangeError(`convertBase() to_base argument must be between 2 and ${range.length}`);

        let from_range = range.slice(0, from_base);
        let to_range = range.slice(0, to_base);

        let from_base_big = BigInt(from_base);
        let to_base_big = BigInt(to_base);

        let dec_value = value.split("").reverse().reduce((carry, digit, index) => {
            let fromIndex = from_range.indexOf(digit);
            if (fromIndex === -1)
                throw new Error(`Invalid digit ${digit} for base ${from_base}.`);
            return carry + BigInt(fromIndex) * bigIntPow(from_base_big, BigInt(index));
        }, BigInt(0));

        let new_value = "";
        while (dec_value > 0) {
            new_value = to_range[dec_value % to_base_big] + new_value;
            dec_value = (dec_value - dec_value % to_base_big) / to_base_big;
        }
        return new_value || "0";
    };
    let extra_encode = text => undefined; //convertBaseBigInt(CryptoJS.SHA3(text).toString(CryptoJS.enc.Hex), 16, 93);
    let youtube_sub_channelids = [];

    function send_gg_auth(code, callback, grant_type = "authorization_code") {
        var url = "https://oauth2.googleapis.com/token";

        var xhr = new XMLHttpRequest();
        xhr.open("POST", url);

        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                window.history.pushState('page2', 'Title', new URL(location.href).pathname);
                let token = JSON.parse(xhr.responseText).access_token,
                    refresh_token = JSON.parse(xhr.responseText).refresh_token;
                //console_log(getCookie("ggauth_refresh_token"), xhr.responseText, token, refresh_token);
                callback(token, refresh_token);
            }
        };

        var data = "grant_type=" + grant_type + (grant_type == "authorization_code" ? "&code=" : "&refresh_token=") + code + "&client_id=" + client_id + "&client_secret=" + client_secret + "&redirect_uri=" + encodeURIComponent(redirect_uri) + ""; // &prompt=consent&access_type=offline

        xhr.send(data);
    }

    function refresh_token(type, callback) {
        let code = (type == "authorization_code" ? new URL(location.href).searchParams.get("code") : getCookie("ggauth_refresh_token"));
        send_gg_auth(code, (token, refresh_token) => {
            if (refresh_token)
                setCookie("ggauth_refresh_token", refresh_token, access_token_cookie_exdays);
            callback(token);
        }, type);
    }

    function get_access_token(callback) {
        if (getCookie("ggauth_refresh_token") && getCookie("ggauth_refresh_token") != "undefined")
            refresh_token("refresh_token", callback);
        else {
            let code_param = new URL(location.href).searchParams.get("code");
            if (code_param)
                refresh_token("authorization_code", callback);
            else
                gg_auth_func();
        }
    }

    function send_ytb_sub(code, callback) {
        fetch("https://youtube.googleapis.com/youtube/v3/subscriptions?part=snippet,contentDetails&maxResults=100&mine=true&key=" + api_key, {
            headers: {
                Accept: "application/json",
                Authorization: "Bearer " + code
            }
        }).then(res => res.json()).then(json => {
            let counter = 0;
            if (!json.items) {
                setCookie("ggauth_refresh_token", "undefined", access_token_cookie_exdays);
                location.reload();
            }
            json.items.forEach((channel, index) => {
                fetch("https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=" + channel.snippet.resourceId.channelId.replace("C", "U") + "&key=" + api_key)
                    .then(res => res.json())
                    .then(new_json => {
                        let temp = [];
                        new_json.items.slice(0, channel.contentDetails.newItemCount <= 3 ? 3 : channel.contentDetails.newItemCount).forEach(item => {
                            temp.push({
                                title: item.snippet.title,
                                source: item.snippet.channelTitle,
                                link: "https://youtube.com/watch?v=" + item.snippet.resourceId.videoId,
                                image: item.snippet.thumbnails.default.url,
                                time: item.snippet.publishedAt
                            });
                        });
                        youtube_sub_channelids.push(temp);
                        youtube_sub_channelids = youtube_sub_channelids.flat();
                        counter++;
                        if (counter == json.items.length) callback();
                    });
            });
        });
    }

    function gg_auth_func() {
        location.href = "https://accounts.google.com/o/oauth2/auth/oauthchooseaccount?scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fyoutube.readonly&response_type=code&access_type=offline&redirect_uri=" + encodeURIComponent(redirect_uri) + "&client_id=" + client_id + "&flowName=GeneralOAuthFlow";
    }

    //if (ytb_enabled) {
    loadScript("https://code.jquery.com/jquery-3.6.0.min.js", (path, status) => {
        if (status == "ok")
            get_access_token(access_token => {
                send_ytb_sub(access_token, loadmore_x);
            });
    });
        /* let code_param = new URL(location.href).searchParams.get("code");
if (code_param)
setCookie("ggauth", code_param, access_token_cookie_exdays);
if (save_cookie && getCookie("ggauth") && getCookie("ggauth") != "")
send_gg_auth(getCookie("ggauth"), loadmore_x);
else if (!code_param)
gg_auth_func();
else
send_gg_auth(code_param, loadmore_x); */
    //}
</script>
