<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"
    integrity="sha512-E8QSvWZ0eCLGk4km3hxSsNmGWbLtSCSUcewDQPQWZF6pEU8GlT8a5fF32wOl1i8ftdMhssTrF/OhyGWwonTcXA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<style>
    div.article {
        margin: 10px;
        border: 1px solid #ccc;
        border-radius: 10px;
        padding: 10px;
        cursor: pointer;
        height: 121px;
    }

    div.article img {
        float: left;
        border-radius: 5px;
        margin-right: 10px;
        width: 100px;
        height: 80%;
    }
</style>
<script>
    let
        api_key = "AIzaSyCUyUlEcT2eul0-_5k6X15WN_d3Mgu_jrM",
        client_id = "509723180239-df84foq7m5lc2g158sqdqnb9ummdphhl.apps.googleusercontent.com",
        client_secret = "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",
        access_token_cookie_exdays = 36500,
        redirect_uri = new URL(location.href).hostname == "127.0.0.1" ? "http://127.0.0.1:5500" : "https://phonglan123.github.io/archive/dailynews.html";

    (function (a, b) { if (typeof define === "function" && define.amd) { define([], b); } else { if (typeof exports === "object") { module.exports = b(); } else { a.X2JS = b(); } } }(this, function () { return function (z) { var t = "1.2.0"; z = z || {}; i(); u(); function i() { if (z.escapeMode === undefined) { z.escapeMode = true; } z.attributePrefix = z.attributePrefix || "_"; z.arrayAccessForm = z.arrayAccessForm || "none"; z.emptyNodeForm = z.emptyNodeForm || "text"; if (z.enableToStringFunc === undefined) { z.enableToStringFunc = true; } z.arrayAccessFormPaths = z.arrayAccessFormPaths || []; if (z.skipEmptyTextNodesForObj === undefined) { z.skipEmptyTextNodesForObj = true; } if (z.stripWhitespaces === undefined) { z.stripWhitespaces = true; } z.datetimeAccessFormPaths = z.datetimeAccessFormPaths || []; if (z.useDoubleQuotes === undefined) { z.useDoubleQuotes = false; } z.xmlElementsFilter = z.xmlElementsFilter || []; z.jsonPropertiesFilter = z.jsonPropertiesFilter || []; if (z.keepCData === undefined) { z.keepCData = false; } } var h = { ELEMENT_NODE: 1, TEXT_NODE: 3, CDATA_SECTION_NODE: 4, COMMENT_NODE: 8, DOCUMENT_NODE: 9 }; function u() { } function x(B) { var C = B.localName; if (C == null) { C = B.baseName; } if (C == null || C == "") { C = B.nodeName; } return C; } function r(B) { return B.prefix; } function s(B) { if (typeof (B) == "string") { return B.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&apos;"); } else { return B; } } function k(B) { return B.replace(/&lt;/g, "<").replace(/&gt;/g, ">").replace(/&quot;/g, '"').replace(/&apos;/g, "'").replace(/&amp;/g, "&"); } function w(C, F, D, E) { var B = 0; for (; B < C.length; B++) { var G = C[B]; if (typeof G === "string") { if (G == E) { break; } } else { if (G instanceof RegExp) { if (G.test(E)) { break; } } else { if (typeof G === "function") { if (G(F, D, E)) { break; } } } } } return B != C.length; } function n(D, B, C) { switch (z.arrayAccessForm) { case "property": if (!(D[B] instanceof Array)) { D[B + "_asArray"] = [D[B]]; } else { D[B + "_asArray"] = D[B]; } break; }if (!(D[B] instanceof Array) && z.arrayAccessFormPaths.length > 0) { if (w(z.arrayAccessFormPaths, D, B, C)) { D[B] = [D[B]]; } } } function a(G) { var E = G.split(/[-T:+Z]/g); var F = new Date(E[0], E[1] - 1, E[2]); var D = E[5].split("."); F.setHours(E[3], E[4], D[0]); if (D.length > 1) { F.setMilliseconds(D[1]); } if (E[6] && E[7]) { var C = E[6] * 60 + Number(E[7]); var B = /\d\d-\d\d:\d\d$/.test(G) ? "-" : "+"; C = 0 + (B == "-" ? -1 * C : C); F.setMinutes(F.getMinutes() - C - F.getTimezoneOffset()); } else { if (G.indexOf("Z", G.length - 1) !== -1) { F = new Date(Date.UTC(F.getFullYear(), F.getMonth(), F.getDate(), F.getHours(), F.getMinutes(), F.getSeconds(), F.getMilliseconds())); } } return F; } function q(D, B, C) { if (z.datetimeAccessFormPaths.length > 0) { var E = C.split(".#")[0]; if (w(z.datetimeAccessFormPaths, D, B, E)) { return a(D); } else { return D; } } else { return D; } } function b(E, C, B, D) { if (C == h.ELEMENT_NODE && z.xmlElementsFilter.length > 0) { return w(z.xmlElementsFilter, E, B, D); } else { return true; } } function A(D, J) { if (D.nodeType == h.DOCUMENT_NODE) { var K = new Object; var B = D.childNodes; for (var L = 0; L < B.length; L++) { var C = B.item(L); if (C.nodeType == h.ELEMENT_NODE) { var I = x(C); K[I] = A(C, I); } } return K; } else { if (D.nodeType == h.ELEMENT_NODE) { var K = new Object; K.__cnt = 0; var B = D.childNodes; for (var L = 0; L < B.length; L++) { var C = B.item(L); var I = x(C); if (C.nodeType != h.COMMENT_NODE) { var H = J + "." + I; if (b(K, C.nodeType, I, H)) { K.__cnt++; if (K[I] == null) { K[I] = A(C, H); n(K, I, H); } else { if (K[I] != null) { if (!(K[I] instanceof Array)) { K[I] = [K[I]]; n(K, I, H); } } (K[I])[K[I].length] = A(C, H); } } } } for (var E = 0; E < D.attributes.length; E++) { var F = D.attributes.item(E); K.__cnt++; K[z.attributePrefix + F.name] = F.value; } var G = r(D); if (G != null && G != "") { K.__cnt++; K.__prefix = G; } if (K["#text"] != null) { K.__text = K["#text"]; if (K.__text instanceof Array) { K.__text = K.__text.join("\n"); } if (z.stripWhitespaces) { K.__text = K.__text.trim(); } delete K["#text"]; if (z.arrayAccessForm == "property") { delete K["#text_asArray"]; } K.__text = q(K.__text, I, J + "." + I); } if (K["#cdata-section"] != null) { K.__cdata = K["#cdata-section"]; delete K["#cdata-section"]; if (z.arrayAccessForm == "property") { delete K["#cdata-section_asArray"]; } } if (K.__cnt == 0 && z.emptyNodeForm == "text") { K = ""; } else { if (K.__cnt == 1 && K.__text != null) { K = K.__text; } else { if (K.__cnt == 1 && K.__cdata != null && !z.keepCData) { K = K.__cdata; } else { if (K.__cnt > 1 && K.__text != null && z.skipEmptyTextNodesForObj) { if ((z.stripWhitespaces && K.__text == "") || (K.__text.trim() == "")) { delete K.__text; } } } } } delete K.__cnt; if (z.enableToStringFunc && (K.__text != null || K.__cdata != null)) { K.toString = function () { return (this.__text != null ? this.__text : "") + (this.__cdata != null ? this.__cdata : ""); }; } return K; } else { if (D.nodeType == h.TEXT_NODE || D.nodeType == h.CDATA_SECTION_NODE) { return D.nodeValue; } } } } function o(I, F, H, C) { var E = "<" + ((I != null && I.__prefix != null) ? (I.__prefix + ":") : "") + F; if (H != null) { for (var G = 0; G < H.length; G++) { var D = H[G]; var B = I[D]; if (z.escapeMode) { B = s(B); } E += " " + D.substr(z.attributePrefix.length) + "="; if (z.useDoubleQuotes) { E += '"' + B + '"'; } else { E += "'" + B + "'"; } } } if (!C) { E += ">"; } else { E += "/>"; } return E; } function j(C, B) { return "</" + (C.__prefix != null ? (C.__prefix + ":") : "") + B + ">"; } function v(C, B) { return C.indexOf(B, C.length - B.length) !== -1; } function y(C, B) { if ((z.arrayAccessForm == "property" && v(B.toString(), ("_asArray"))) || B.toString().indexOf(z.attributePrefix) == 0 || B.toString().indexOf("__") == 0 || (C[B] instanceof Function)) { return true; } else { return false; } } function m(D) { var C = 0; if (D instanceof Object) { for (var B in D) { if (y(D, B)) { continue; } C++; } } return C; } function l(D, B, C) { return z.jsonPropertiesFilter.length == 0 || C == "" || w(z.jsonPropertiesFilter, D, B, C); } function c(D) { var C = []; if (D instanceof Object) { for (var B in D) { if (B.toString().indexOf("__") == -1 && B.toString().indexOf(z.attributePrefix) == 0) { C.push(B); } } } return C; } function g(C) { var B = ""; if (C.__cdata != null) { B += "<![CDATA[" + C.__cdata + "]]>"; } if (C.__text != null) { if (z.escapeMode) { B += s(C.__text); } else { B += C.__text; } } return B; } function d(C) { var B = ""; if (C instanceof Object) { B += g(C); } else { if (C != null) { if (z.escapeMode) { B += s(C); } else { B += C; } } } return B; } function p(C, B) { if (C === "") { return B; } else { return C + "." + B; } } function f(D, G, F, E) { var B = ""; if (D.length == 0) { B += o(D, G, F, true); } else { for (var C = 0; C < D.length; C++) { B += o(D[C], G, c(D[C]), false); B += e(D[C], p(E, G)); B += j(D[C], G); } } return B; } function e(I, H) { var B = ""; var F = m(I); if (F > 0) { for (var E in I) { if (y(I, E) || (H != "" && !l(I, E, p(H, E)))) { continue; } var D = I[E]; var G = c(D); if (D == null || D == undefined) { B += o(D, E, G, true); } else { if (D instanceof Object) { if (D instanceof Array) { B += f(D, E, G, H); } else { if (D instanceof Date) { B += o(D, E, G, false); B += D.toISOString(); B += j(D, E); } else { var C = m(D); if (C > 0 || D.__text != null || D.__cdata != null) { B += o(D, E, G, false); B += e(D, p(H, E)); B += j(D, E); } else { B += o(D, E, G, true); } } } } else { B += o(D, E, G, false); B += d(D); B += j(D, E); } } } } B += d(I); return B; } this.parseXmlString = function (D) { var F = window.ActiveXObject || "ActiveXObject" in window; if (D === undefined) { return null; } var E; if (window.DOMParser) { var G = new window.DOMParser(); var B = null; if (!F) { try { B = G.parseFromString("INVALID", "text/xml").getElementsByTagName("parsererror")[0].namespaceURI; } catch (C) { B = null; } } try { E = G.parseFromString(D, "text/xml"); if (B != null && E.getElementsByTagNameNS(B, "parsererror").length > 0) { E = null; } } catch (C) { E = null; } } else { if (D.indexOf("<?") == 0) { D = D.substr(D.indexOf("?>") + 2); } E = new ActiveXObject("Microsoft.XMLDOM"); E.async = "false"; E.loadXML(D); } return E; }; this.asArray = function (B) { if (B === undefined || B == null) { return []; } else { if (B instanceof Array) { return B; } else { return [B]; } } }; this.toXmlDateTime = function (B) { if (B instanceof Date) { return B.toISOString(); } else { if (typeof (B) === "number") { return new Date(B).toISOString(); } else { return null; } } }; this.asDateTime = function (B) { if (typeof (B) == "string") { return a(B); } else { return B; } }; this.xml2json = function (B) { return A(B); }; this.xml_str2json = function (B) { var C = this.parseXmlString(B); if (C != null) { return this.xml2json(C); } else { return null; } }; this.json2xml_str = function (B) { return e(B, ""); }; this.json2xml = function (C) { var B = this.json2xml_str(C); return this.parseXmlString(B); }; this.getVersion = function () { return t; }; }; }));
    let encodeURIComponent_x = text => encodeURIComponent(text).replace(/\'|\"/g, "");
    function setCookie(cname, cvalue, exdays) {
        const d = new Date();
        d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
        let expires = "expires=" + d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }
    function getCookie(cname) {
        let name = cname + "=";
        let decodedCookie = decodeURIComponent(document.cookie);
        let ca = decodedCookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }
    let
        get_wl = (full = false) => {
            let me = JSON.parse(localStorage.getItem('whitelist') || "{}");
            Object.entries(me).forEach(entry => {
                if (new Date().getTime() - parseInt(entry[0]) >= 172800000)
                    delete me[entry[0]];
            });
            localStorage.setItem("whitelist", JSON.stringify(me));
            return full ? me : Object.values(me);
        },
        whitelist = get_wl(),
        full_whitelist = get_wl(true),
        curent_index = 0,
        set_whitelist = (article, main_title, value = new Date().getTime()) => {
            if (main_title == "Reddit")
                article.pubDate = article.created;
            //if (!full_whitelist[main_title] || new Date(article.pubDate).getTime() > full_whitelist[main_title])
            full_whitelist[main_title] = value;
            localStorage.setItem("whitelist", JSON.stringify(full_whitelist));
        },
        check_whitelist = title => {

        };
    function process_gg_news(link, main_title, callback) {
        fetch("https://api.allorigins.win/get?url=" + encodeURIComponent_x(link) + "?ts=" + new Date().getTime())
            .then(res => res.json())
            .then(json => {
                let articles = $($.parseHTML(json.contents).find(elm => elm.tagName == "C-WIZ")).find("c-wiz c-wiz main div div");
                let results = []
                let i = 0
                const urlChecklist = []
                const findOnlyOne = (elm, query) => {
                    let found_elm = $(elm).find(query);
                    if (found_elm.length > 0) return $(found_elm[0]);
                    else return found_elm;
                }
                $(articles).each(function () {
                    if ($(this).find('a[href^="./article"]').length == 0) return undefined;
                    const link = $(this).find('a[href^="./article"]').attr('href').replace('./', 'https://news.google.com/') || false
                    link && urlChecklist.push(link)
                    const mainArticle = {
                        "title": $(this).find('h3').text().trim() || false,
                        "link": link,
                        "image": $(this).find('figure').find('img').attr('src') || false,
                        "source": findOnlyOne(this, "div:last-child svg+a").text().trim() || false,
                        "time": findOnlyOne(this, "div:last-child time").text() || false,
                        "pubDate": findOnlyOne(this, "div:last-child time").attr("datetime") || false,
                        "related": []
                    }
                    const subArticles = $(this).find('div[jsname]').find('article')
                    $(subArticles).each(function () {
                        const subLink = $(this).find('a').first().attr('href').replace('./', 'https://news.google.com/') || false
                        if (subLink && !urlChecklist.includes(subLink)) {
                            mainArticle.related.push({
                                "title": $(this).find('h4').text() || $(this).find('h4 a').text() || false,
                                "link": subLink,
                                "source": $(this).find('div:last-child svg+a').text() || false,
                                "time": $(this).find('div:last-child time').text() || false
                            })
                        }
                    })
                    if (mainArticle.title && (i + 1) % 3 == 0) results.push(mainArticle)
                    i++
                });
                callback(results);
                document.body.innerHTML += "<h1>" + main_title + "</h1>";
                let flag = false;
                results.forEach(article => {
                    flag = check_title_post(article, main_title, flag);
                    if (!flag)
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.link + "\");'>" + (article.image ? "<img src='" + article.image + "'/>" : "") + "<div><h3>" + article.title + "</h3><i>" + article.source + " - " + article.time + "</i></div></div></div>")
                });
                document.body.innerHTML += "<i>Đã tải xong!</i>";
                set_whitelist(results.slice(0, 1)[0], main_title);
            });
    }
    function process_reddit(json, main_title, callback) {
        let flag = false;
        console.log(JSON.parse(json.contents).data.children);
        JSON.parse(json.contents).data.children.forEach(article => {
            article = article.data;
            article.pubDate = article.created;
            flag = check_title_post(article, main_title, flag);
            if (!flag)
                document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"https://reddit.com" + article.permalink + "\");'>" + (article.preview ? ("<img src='" + article.preview.images[0].source.url + "'/>") : "") + "<h3>" + article.title + "</h3><i><b>" + article.author + "</b> posted in <b>" + article.subreddit + "</b> - " + article.created + "</i></div><button style='display: none;' onclick='set_whitelist(`" + encodeURIComponent_x(article.title) + "`, this)'>Xong!</button></div>");
        });
        document.body.innerHTML += "<i>Đã tải xong!</i>";
        set_whitelist(JSON.parse(json.contents).data.children[0].data, main_title);
        callback();
    }
    function loadmore(callback) {
        //elm.innerHTML = elm.innerHTML.replace("max", link_list.length);
        //elm.querySelector("span").innerHTML = curent_index + 1;
        if (typeof link_list[curent_index][0] == "function") {
            document.body.innerHTML += "<h1>" + link_list[curent_index][1] + "</h1>";
            link_list[curent_index][0](link_list[curent_index][1], callback);
        } else
            process_gg_news(link_list[curent_index][0], link_list[curent_index][1], news => {
                console.log(news);
                callback();
            });
    }
    let is_active = true;
    document.addEventListener("visibilitychange", event => {
        is_active = !document.hidden;
    });
    function loadmore_x() {
        loadmore(() => {
            curent_index++;
            if (curent_index < link_list.length) loadmore_x();
            else {
                //alert("Đã tải xong tất cả!");
                let alert_box = document.createElement("div");
                alert_box.style = "box-shadow: 0 10px 18px rgb(0 0 0 / 30%); position: fixed; top: 10px; right: 10px; padding: 10px; width: fit-content; box-sizing: border-box; background: white; border-radius: 10px; color: red; font-size: 20px; font-weight: bold; cursor: pointer;";
                alert_box.innerHTML = "Đã tải xong tất cả!";
                alert_box.id = "alert_box";
                alert_box.setAttribute('onclick', "this.style.display = 'none';");
                document.body.appendChild(alert_box);
                if (!is_active)
                    alert("Đã tải xong tất cả!");
            }
        });
    }
    function process_ytb(main_title, callback) {
        youtube_sub_channelids.sort((a, b) => new Date(b.time) - new Date(a.time));
        console.log(youtube_sub_channelids);
        if (!full_whitelist[main_title] || typeof full_whitelist[main_title] != "object")
            full_whitelist[main_title] = []
        //console.log(JSON.stringify(full_whitelist[main_title]));
        full_whitelist[main_title].forEach((title, index) => {
            if (!youtube_sub_channelids.map(article => article.title).includes(title))
                delete full_whitelist[main_title][index];
        });
        //console.log(JSON.stringify(full_whitelist[main_title]));
        youtube_sub_channelids.forEach(article => {
            if (!full_whitelist[main_title].includes(article.title)) {
                document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.link + "\");'><img src='" + article.image + "'/><div><h3>" + article.title + "</h3><i>" + article.source + " - " + article.time + "</i></div></div><button style='display: none;' onclick='set_whitelist(`" + encodeURIComponent_x(article.title) + "`, this)'>Xong!</button></div>");
                full_whitelist[main_title].push(article.title);
            }
        });
        document.body.innerHTML += "<i>Đã tải xong!</i>";
        full_whitelist[main_title] = full_whitelist[main_title].filter(n => n);
        //set_whitelist(youtube_sub_channelids.slice(0, 1)[0].title, main_title);
        localStorage.setItem("whitelist", JSON.stringify(full_whitelist));
        callback();
    }
    const link_list = [
        [(main_title, callback) => process_quote([
            ["[20% khách hàng] tạo ra [80% lợi nhuận] công ty!", "Quy luật 80-20"],
            ["May mắn ở [ngoài vùng an toàn]!", "Tư duy của người Do Thái"],
            ["Don't leave your comfort zone, [expand] it!", "Elizabeth Kuster"],
            ["Không có [thất bại], chỉ có [kinh nghiệm]!", "Adom Khoo"],
            ["[Ước mơ to], [bước đi nhỏ]!", "Adom Khoo"],
            ["Nếu cơ hội chưa gõ cửa nhà bạn tức là bạn chưa có cửa. [Hãy làm lấy một cái]!", "Adom Khoo"],
            ["Hãy bơi trong [luồng nước rộng]!", "Sách Chiến lược đại dương xanh"],
            ["Bây giờ, không còn là cá lớn nuốt cá bé, mà là [cá nhanh nuốt cá chậm]!", "Sách Xây dựng để trường tồn"],
            ["Sự thật là các công ty hàng đầu [không] hề bắt đầu từ một [ý tưởng vĩ đại].", "Sách Xây dựng để trường tồn"],
            ["Một đầu óc thông minh siêu việt phải có khả năng nắm giữ [hai ý tưởng trái ngược] cùng một lúc, mà vẫn có thể phân tích chúng", "F. Scott Fitzgerald"],
            ["[Tốt] là kẻ thù của [vĩ đại]!", "Sách Từ tốt đến vĩ đại"],
            ["Living your [someday], [today]!", "Brett (someone)"],
            ["Người ta không mắc sai lầm vì dốt mà vì [tưởng mình giỏi]", "Daniil Granin"],
            ["[Tập trung] về cơ bản chỉ là [thoát khỏi cám dỗ]!", "Nguyễn Hải Phong (tui nè ^^)"],
            ["Rồi chúng ta sẽ [khóc] với những thứ đã từng làm chúng ta [cười]", "Someone"],
            ["Một người lãnh đạo giỏi thì không được phép [mất kiểm soát] hay [than vãn]", "Nguyễn Hải Phong (tui nè ^^)"],
            ["Những [bước nhỏ nhất] mà bạn có thể [thực hiện ngay hôm nay] để có thể giúp bạn tiến gần hơn tới [mục tiêu lớn nhất] là gì?", "CafeBiz"]
        ], main_title, callback), "Trích dẫn hay"],
        [(main_title, callback) => process_wikipedia("default", 0, main_title, callback, {}), "Wikipedia"],
        [(main_title, callback) => process_ytb(main_title, callback), "YouTube"],
        [(main_title, callback) => process_morningbrew(main_title, callback), "Morning Brew"],
        [(main_title, callback) => process_morningbrew_podcast("https://feeds.megaphone.fm/MOBI8777994188", main_title, callback), "[MBP] Business Casual"],
        [(main_title, callback) => process_morningbrew_podcast("https://feeds.megaphone.fm/MOBI4141652289", main_title, callback), "[MBP] Founder's Journal"],
        [(main_title, callback) => process_morningbrew_podcast("https://feeds.megaphone.fm/imposters-mb", main_title, callback), "[MBP] Imposters"],
        [(main_title, callback) => process_stackoverflow("https://stackoverflow.blog/newsletter/feed/", main_title, callback), "The Overflow"],
        [(main_title, callback) => process_stackoverflow_podcast("https://stackoverflow.blog/podcast/feed/", main_title, callback), "Stack Overflow Podcast"],
        [(main_title, callback) => process_manhhomienbienthuy("https://manhhomienbienthuy.github.io/feeds/rss.xml", main_title, callback), "Blog manhhomienbienthuy"],
        [(main_title, callback) => process_lostbird("https://api.lostbird.vn/lostbird/public/v1/posts?per_page=50", main_title, callback), "Lost bird"],
        [(main_title, callback) => process_fb("http://fetchrss.com/rss/61f8c4e41d2c61396121d08261f8c4b70bc83a6c8f771002.xml", main_title, callback), "Kinh tế học giản đơn"],
        ["https://news.google.com/publications/CAAqBwgKMI-apgsw96S-Aw?hl=vi&gl=VN&ceid=VN%3Avi", "VnEconomy"],
        ["https://news.google.com/topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNRFZxYUdjU0FuWnBHZ0pXVGlnQVAB?hl=vi&gl=VN&ceid=VN%3Avi", "Tin tức chung"]

        //[(main_title, callback) => process_weather(callback), "Dự báo thời tiết"],
        //[(main_title, callback) => process_tinhte("https://tinhte.vn/rss", main_title, callback), "Tinh tế"],
        //["https://news.google.com/publications/CAAqIQgKIhtDQklTRGdnTWFnb0tDR05oWm1WbUxuWnVLQUFQAQ?hl=vi&gl=VN&ceid=VN%3Avi", "CafeF"],
        //["https://news.google.com/publications/CAAqJAgKIh5DQklTRUFnTWFnd0tDbU5oWm1WaWFYb3VkbTRvQUFQAQ?hl=vi&gl=VN&ceid=VN%3Avi", "Cafebiz"],
        //[(main_title, callback) => process_sputniknews("https://vn.sputniknews.com/services/widget/lenta/", main_title, callback), "Sputnik News VN"],
        //[(main_title, callback) => process_spiderum("https://spiderum.com/api/v1/feed/getAllPosts?type=new&page=1", main_title, callback), "Spiderum"],
        //[(main_title, callback) => process_reddit_subfunc("https://www.reddit.com/.json?feed=7fdac8ab65101cd21a5d5e6e6f4dfad19071f347&user=phonghng", main_title, callback), "Reddit"],
        //["https://news.google.com/topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNRFZxYUdjU0FuWnBHZ0pXVGlnQVAB/sections/CAQiTENCQVNNd29JTDIwdk1EVnFhR2NTQW5acEdnSldUaUlQQ0FRYUN3b0pMMjB2TURGamNtUTFLZzRLREJJS1Ztbmh1NGQwSUU1aGJTZ0EqKggAKiYICiIgQ0JBU0Vnb0lMMjB2TURWcWFHY1NBblpwR2dKV1RpZ0FQAVAB?hl=vi&gl=VN&ceid=VN%3Avi", "VN"],
        //["https://news.google.com/topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNRFZxYUdjU0FuWnBHZ0pXVGlnQVAB/sections/CAQiTkNCQVNOQW9JTDIwdk1EVnFhR2NTQW5acEdnSldUaUlPQ0FRYUNnb0lMMjB2TURsdWJWOHFFQW9PRWd4VWFPRzZ2eUJuYWVHN20ya29BQSoqCAAqJggKIiBDQkFTRWdvSUwyMHZNRFZxYUdjU0FuWnBHZ0pXVGlnQVABUAE?hl=vi&gl=VN&ceid=VN%3Avi", "TG"],
        //["https://news.google.com/topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNRFZxYUdjU0FuWnBHZ0pXVGlnQVAB/sections/CAQiS0NCQVNNZ29JTDIwdk1EVnFhR2NTQW5acEdnSldUaUlPQ0FRYUNnb0lMMjB2TURadWRHb3FEZ29NRWdwVWFPRzdneUIwYUdGdktBQSoqCAAqJggKIiBDQkFTRWdvSUwyMHZNRFZxYUdjU0FuWnBHZ0pXVGlnQVABUAE?hl=vi&gl=VN&ceid=VN%3Avi", "Thể thao"],
        //["https://news.google.com/topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNRFZxYUdjU0FuWnBHZ0pXVGlnQVAB/sections/CAQiTENCQVNNd29JTDIwdk1EVnFhR2NTQW5acEdnSldUaUlPQ0FRYUNnb0lMMjB2TURKcWFuUXFEd29ORWd0SGFlRzZvMmtnZEhMRHJTZ0EqKggAKiYICiIgQ0JBU0Vnb0lMMjB2TURWcWFHY1NBblpwR2dKV1RpZ0FQAVAB?hl=vi&gl=VN&ceid=VN%3Avi", "Giải trí"],
        //["https://news.google.com/topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNRFZxYUdjU0FuWnBHZ0pXVGlnQVAB/sections/CAQiUENCQVNOZ29JTDIwdk1EVnFhR2NTQW5acEdnSldUaUlPQ0FRYUNnb0lMMjB2TURsek1XWXFFZ29RRWc1RWIyRnVhQ0J1WjJocDRidUhjQ2dBKioIAComCAoiIENCQVNFZ29JTDIwdk1EVnFhR2NTQW5acEdnSldUaWdBUAFQAQ?hl=vi&gl=VN&ceid=VN%3Avi", "Doanh nghiệp"],
    ];
    function remove_from_dom(dom, elm) {
        elm.parentNode.removeChild(elm);
        return dom;
    }
    (function () {
        if (typeof Object.defineProperty === 'function') {
            try { Object.defineProperty(Array.prototype, 'sortBy', { value: sb }); } catch (e) { }
        }
        if (!Array.prototype.sortBy) Array.prototype.sortBy = sb;

        function sb(f) {
            for (var i = this.length; i;) {
                var o = this[--i];
                this[i] = [].concat(f.call(o, o, i), o);
            }
            this.sort(function (a, b) {
                for (var i = 0, len = a.length; i < len; ++i) {
                    if (a[i] != b[i]) return a[i] < b[i] ? -1 : 1;
                }
                return 0;
            });
            for (var i = this.length; i;) {
                this[--i] = this[i][this[i].length - 1];
            }
            return this;
        }
    })();
    function process_morningbrew(main_title, callback) {
        let issues_alias = ["daily", "money-scoop", "sidekick", "emerging-tech", "hr", "marketing", "retail", "money-with-katie"],
            articles = [];
        issues_alias.forEach(issue => {
            process_morningbrew_issue("https://www.morningbrew.com/" + issue + "/issues/latest", main_title, article => {
                let flag = false;
                flag = check_title_post(article, main_title, flag);
                if (!flag) {
                    document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.link + "\");'><div><img src='" + article.image + "'/><h3>" + article.title + "</h3><i>" + article.pubdate_text + "</i></div></div></div>")
                }
                articles.push(article);
                if (articles.length == issues_alias.length) {
                    articles = articles.sortBy(o => o.pubDate);
                    console.log(articles);
                    document.body.innerHTML += "<i>Đã tải xong!</i>";
                    set_whitelist(JSON.parse(JSON.stringify(articles)).pop(), main_title); 
                    callback();
                }
            });
        });
    }
    function process_morningbrew_issue(url, main_title, callback) {
        fetch("https://api.allorigins.win/get?url=" + encodeURIComponent(url))
            .then(res => res.json())
            .then(json => {
                let parsed = $.parseHTML(json.contents);
                parsed.forEach(elm => {
                    if (elm.id == "__next")
                        parsed = elm;
                });
                let title = parsed.querySelectorAll("h6")[0].innerText;
                parsed = parsed.querySelectorAll("main div *");
                parsed.forEach(elm => {
                    if (elm.className.startsWith("Issue__IssueHTMLWrapper-sc-"))
                        parsed = elm;
                });
                parsed.querySelectorAll("*").forEach(elm => {
                    if (
                        ((elm.style.display == "none")
                        || (elm.className.includes("hidden"))
                        || (elm.tagName == "STYLE")
                        || (elm.tagName == "TITLE")
                        || (elm.tagName == "META")
                        || (elm.tagName == "LINK"))
                        && elm.innerHTML.match(/\w+ \d{2}, \d{4}/g) == null
                    )
                        parsed = remove_from_dom(parsed, elm);
                });
                const months = Array.from({ length: 12 }, (e, i) => { return new Date(null, i + 1, null).toLocaleDateString("en", { month: "long" }); });
                let pubdate = parsed.innerHTML.match(/\w+ \d{2}, \d{4}/g);
                pubdate.forEach((date, index) => {
                    let flag = false;
                    months.forEach(month => {
                        if (date.includes(month))
                            flag = true;
                    });
                    if (!flag)
                        delete pubdate[index];
                });
                pubdate = pubdate[0];
                let link = undefined;
                parsed.querySelectorAll("a").forEach(elm => {
                    if (elm.innerText == pubdate)
                        link = elm.href;
                })
                let image = undefined;
                parsed.querySelectorAll("img").forEach(elm => {
                    if (new URL(elm.src).hostname == "cdn.sanity.io")
                        image = elm.src;
                })
                let article = {
                    pubDate: new Date(pubdate),
                    title: title,
                    image: image,
                    link: link,
                    pubdate_text: pubdate
                }
                callback(article);
            });
    }
    function process_morningbrew_podcast(url, main_title, callback) {
        fetch("https://api.allorigins.win/get?url=" + encodeURIComponent(url))
            .then(res => res.json())
            .then(json => {
                let parsed = new X2JS().xml_str2json(json.contents).rss.channel.item;
                console.log(parsed);
                let flag = false;
                parsed.slice(0, 10).forEach(article => {
                    if ((Array.isArray(article.title) ? article.title[0] : article.title).startsWith("Bonus"))
                        return undefined;
                    flag = check_title_post(article, main_title, flag);
                    if (!flag)
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.enclosure._url + "\");'><div>" + (article.image ? "<img src='" + article.image._href + "'/>" : "") + "<h3>" + (Array.isArray(article.title) ? article.title[0] : article.title) + "</h3><i>" + new Date(article.pubDate) + "</i></div></div></div>")
                });
                document.body.innerHTML += "<i>Đã tải xong!</i>";
                set_whitelist(parsed.slice(0, 1)[0], main_title);
                callback();
            });
    }
    function process_reddit_subfunc(url, main_title, callback) {
        fetch("https://api.allorigins.win/get?url=" + encodeURIComponent(url)).then(res => res.json()).then(json => process_reddit(json, main_title, callback));
    }
    function process_manhhomienbienthuy(url, main_title, callback) {
        fetch("https://api.allorigins.win/get?url=" + encodeURIComponent(url))
            .then(res => res.json())
            .then(json => {
                let parsed = new X2JS().xml_str2json(json.contents).rss.channel.item;
                console.log(parsed);
                let flag = false;
                parsed.forEach(article => {
                    flag = check_title_post(article, main_title, flag);
                    if (!flag)
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.link + "\");'><div><h3>" + article.title + "</h3><i>" + new Date(article.pubDate) + "</i></div></div></div>")
                });
                document.body.innerHTML += "<i>Đã tải xong!</i>";
                set_whitelist(parsed.slice(0, 1)[0], main_title);
                callback();
            });
    }
    function process_weather(callback) {
        let script_tag;
        script_tag = document.createElement("iframe");
        script_tag.src = "https://www.tomorrow.io/weather/vi/daily/";
        script_tag.style = "width: 100%; height: 100%; border: none; border-radius: 10px;";
        document.body.appendChild(script_tag);
        script_tag.onload = function () {
            callback();
        }
    }
    function process_quote(quotes, main_title, callback) {
        let
            random_arr = items => Math.floor(Math.random() * items.length),
            saved_quotes = full_whitelist[main_title] || [],
            random_quote = random_arr(quotes);
        if (saved_quotes.length == quotes.length)
            saved_quotes = [];
        while (saved_quotes.includes(random_quote))
            random_quote = random_arr(quotes);
        document.body.innerHTML += `<style>.blockquote-bold { color: #e74848; font-weight: bold; } /* center the blockquote in the page */ .blockquote-wrapper { display: flex; /*height: 100vh;*/ padding: 0 20px; } /* Blockquote main style */ .blockquote { position: relative; font-family: 'Barlow Condensed', sans-serif; max-width: 620px; margin: 80px auto; align-self: center; } /* Blockquote header */ .blockquote h1 { /*font-family: 'Abril Fatface', cursive;*/ position: relative; /* for pseudos */ font-size: 2.8rem; font-weight: normal; line-height: 1; margin: 0; border: 2px solid; border: solid 2px; border-radius:20px; padding: 25px; } /* Blockquote right double quotes */ .blockquote h1:after { content:""; position: absolute; border: 2px solid; border-radius: 0 50px 0 0; width: 60px; height: 60px; bottom: -62px; left: 50px; border-bottom: none; border-left: none; z-index: 3; } .blockquote h1:before { content:""; position: absolute; width: 80px; border: 6px solid white; bottom: -3px; left: 50px; z-index: 2; } /* increase header size after 600px */ @media all and (min-width: 600px) { .blockquote h1 { font-size: 3rem; line-height: 1.2; } } /* Blockquote subheader */ .blockquote h4 { position: relative; font-size: 1.3rem; font-weight: 400; line-height: 1.2; margin: 0; padding-top: 15px; z-index: 1; margin-left:150px; padding-left:12px; margin-top: 5px; font-style: italic; } .blockquote h4:first-letter { margin-left:-12px; }</style><div class="blockquote-wrapper"> <div class="blockquote"> <h1> ${quotes[random_quote][0].replace(/\[/g, "<span class='blockquote-bold'>").replace(/\]/g, "</span>")} </h1> <h4>${quotes[random_quote][1]}<!--<br><em>Web Site Usability: A Designer's Guide</em>--></h4> </div> </div>`;
        saved_quotes.push(random_quote);
        set_whitelist(undefined, main_title, saved_quotes);
        callback();
    }
    function process_sputniknews(url, main_title, callback) {
        fetch("https://api.allorigins.win/get?url=" + encodeURIComponent(url))
            .then(res => res.json())
            .then(json => {
                let parsed = new X2JS().xml_str2json(json.contents).div.div[1].div.div[1].div.div;
                console.log(parsed);
                let flag = false;
                parsed.forEach(article => {
                    article.link = article.a._href;
                    article.title = article.a.span.span[1].__text;
                    article.pubDate = parseInt(article.a.span.span[0]["_data-unixtime"]) * 1000;
                    flag = check_title_post(article, main_title, flag);
                    if (!flag)
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"https://vn.sputniknews.com/" + article.link + "\");'><div><h3>" + article.title + "</h3><i>" + new Date(article.pubDate) + "</i></div></div></div>")
                });
                document.body.innerHTML += "<i>Đã tải xong!</i>";
                set_whitelist(parsed.slice(0, 1)[0], main_title);
                callback();
            });
    }
    function process_lostbird(url, main_title, callback) {
        fetch("https://api.allorigins.win/get?url=" + encodeURIComponent(url))
            .then(res => res.json())
            .then(json => {
                let parsed = JSON.parse(json.contents);
                console.log(parsed);
                let flag = false;
                parsed.forEach(article => {
                    article.pubDate = article.date;
                    flag = check_title_post(article, main_title, flag);
                    if (!flag)
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.permalink + "\");'>" + (article.thumbnails.featured ? "<img src='" + article.thumbnails.featured + "'/>" : "") + "<div><h3>" + article.title + "</h3><i>" + article.pubDate + "</i></div></div></div>")
                });
                document.body.innerHTML += "<i>Đã tải xong!</i>";
                set_whitelist(parsed.slice(0, 1)[0], main_title);
                callback();
            });
    }
    function process_tinhte(url, main_title, callback) {
        fetch("https://api.allorigins.win/get?url=" + url)
            .then(res => res.json())
            .then(json => {
                let parsed = new X2JS().xml_str2json(json.contents).rss.channel.item;
                console.log(parsed);
                let flag = false;
                parsed.forEach(article => {
                    flag = check_title_post(article, main_title, flag);
                    if (!flag)
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.link + "\");'><div><h3>" + article.title + "</h3><i>" + article.creator.__text + " - " + article.pubDate + "</i></div></div></div>")
                });
                document.body.innerHTML += "<i>Đã tải xong!</i>";
                set_whitelist(parsed.slice(0, 1)[0], main_title);
                callback();
            });
    }
    function process_spiderum(url, main_title, callback) {
        fetch(url)
            .then(res => res.json())
            .then(json => {
                let parsed = json.posts.items;
                console.log(parsed);
                let flag = false;
                parsed.forEach(article => {
                    article.pubDate = article.created_at;
                    flag = check_title_post(article, main_title, flag);
                    if (!flag)
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"https://spiderum.com/bai-dang/" + article.slug + "\");'><div>" + (article.og_image_url ? "<img src='" + article.og_image_url + "'/>" : "") + "<h3>" + article.title + "</h3><i>" + article.creator_id.display_name + " - " + article.pubDate + "</i></div></div></div>")
                });
                document.body.innerHTML += "<i>Đã tải xong!</i>";
                set_whitelist(parsed.slice(0, 1)[0], main_title);
                callback();
            });
    }
    function process_fb(url, main_title, callback) {
        fetch("https://api.allorigins.win/get?url=" + url)
            .then(res => res.json())
            .then(json => {
                let parsed = new X2JS().xml_str2json(json.contents).rss.channel.item;
                console.log(parsed);
                let flag = false;
                parsed.forEach(article => {
                    flag = check_title_post(article, main_title, flag);
                    if (!flag)
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.link + "\");'><div><h3>" + article.title + "</h3><i>" + article.creator.__text + " - " + article.pubDate + "</i></div></div></div>")
                });
                document.body.innerHTML += "<i>Đã tải xong!</i>";
                set_whitelist(parsed.slice(0, 1)[0], main_title);
                callback();
            });
    }
    function process_stackoverflow(url, main_title, callback) {
        fetch("https://api.allorigins.win/get?url=" + url)
            .then(res => res.json())
            .then(json => {
                let parsed = new X2JS().xml_str2json(json.contents).rss.channel.item;
                console.log(parsed);
                let flag = false;
                parsed.forEach(article => {
                    flag = check_title_post(article, main_title, flag);
                    if (!flag)
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.link + "\");'><div><h3>" + article.title + "</h3><i>" + article.creator.__text + " - " + article.pubDate + "</i></div></div></div>")
                });
                document.body.innerHTML += "<i>Đã tải xong!</i>";
                set_whitelist(parsed.slice(0, 1)[0], main_title);
                callback();
            });
    }
    function check_title_post(article, main_title, flag) {
        if (full_whitelist[main_title] >= new Date(article.pubDate).getTime()) flag = true;
        else flag = false;
        return flag;
    }
    function process_wikipedia(urls, current_index, main_title, callback, total_results) {
        if (urls == "default")
            urls = [
                ["featured", "Bài viết chọn lọc"],
                ["dyk", "Bạn có biết?"],
                ["good", "Bài viết tốt"],
                ["onthisday", "Ngày này năm xưa"],
                ["potd", "Hình ảnh trong ngày"],
            ];
        if (!document.querySelector("#wikipedia_grid")) {
            let main = document.createElement("div");
            main.style = "--gap: 10px; --min-width: 600px; margin: auto 10px; display: -ms-grid; display: grid; grid-template-columns: repeat(auto-fit, minmax(var(--min-width), 1fr)); grid-gap: var(--gap);";
            main.id = "wikipedia_grid";
            //main.innerHTML = "<h1>" + main_title + "</h1>";
            document.body.appendChild(main);
        }
        let type_name = urls[current_index][0];
        fetch("https://api.allorigins.win/get?url=" + encodeURIComponent("https://vi.wikipedia.org//w/api.php?action=featuredfeed&feed=" + type_name + "&feedformat=atom"))
            .then(res => res.json())
            .then(json => {
                let parsed = new X2JS().xml_str2json(json.contents).feed.entry,
                    summary = parsed[parsed.length - 1].summary.__text,
                    box = document.createElement("div");
                box.style = "margin: 10px; border: 1px solid #ccc; border-radius: 10px; padding: 10px;";
                let box_content = summary.replace(' width="50%" align="right"', ""),
                    pubDate = new Date(parsed[parsed.length - 1].updated).getTime(),
                    flag = true;
                if (full_whitelist[main_title] && full_whitelist[main_title][type_name] && full_whitelist[main_title][type_name] >= pubDate)
                    flag = false;
                box.innerHTML = '<h2 style="margin-left: 8px;">' + urls[current_index][1] + '</h2>' + box_content;
                box.querySelectorAll("a").forEach(link => {
                    if (link.getAttribute("href").startsWith("/wiki"))
                        link.href = "https://vi.wikipedia.org" + link.getAttribute("href");
                    link.target = "_blank";
                });
                if (flag)
                    document.querySelector("#wikipedia_grid").appendChild(box);
                total_results[type_name] = parsed;
                if (!full_whitelist[main_title])
                    full_whitelist[main_title] = {};
                full_whitelist[main_title][type_name] = pubDate;
                localStorage.setItem("whitelist", JSON.stringify(full_whitelist));
                if (current_index == urls.length - 1) {
                    document.body.innerHTML += "<i>Đã tải xong!</i>";
                    console.log(Object.entries(total_results));
                    callback();
                }
                else
                    process_wikipedia(urls, current_index + 1, main_title, callback, total_results);
            });
    }
    function process_stackoverflow_podcast(url, main_title, callback, top_10 = true) {
        fetch("https://api.allorigins.win/get?url=" + url)
            .then(res => res.json())
            .then(json => {
                let parsed = new X2JS().xml_str2json(json.contents).rss.channel.item;
                console.log(parsed);
                let flag = false;
                (top_10 ? parsed.slice(0, 11) : parsed).forEach(article => {
                    flag = check_title_post(article, main_title, flag);
                    if (!flag)
                        document.body.innerHTML += ("<div class='article'><div onclick='window.open(\"" + article.link + "\");'><div><h3>" + article.title + "</h3><i>" + article.creator.__cdata + " - " + article.pubDate + "</i></div></div></div>")
                });
                document.body.innerHTML += "<i>Đã tải xong!</i>";
                set_whitelist(parsed.slice(0, 1)[0], main_title);
                callback();
            });
    }
    let encode_title = title => extra_encode(title);
    let bigIntPow = function power(x, y) {// x**y
        let ZERO = BigInt(0);
        if (y === ZERO) return BigInt(1);
        let TWO = BigInt(2);
        let p2 = power(x, y / TWO);
        if (y % TWO === ZERO) return p2 * p2;
        return x * p2 * p2;
    };
    let convertBaseBigInt = (value, from_base, to_base) => {
        let range = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ`~!@#$%^&*()_+{}|:\"<>?-=[]\\;',./".split("");
        if (from_base < 2 || from_base > range.length)
            throw new RangeError(`convertBase() from_base argument must be between 2 and ${range.length}`);
        if (to_base < 2 || to_base > range.length)
            throw new RangeError(`convertBase() to_base argument must be between 2 and ${range.length}`);

        let from_range = range.slice(0, from_base);
        let to_range = range.slice(0, to_base);

        let from_base_big = BigInt(from_base);
        let to_base_big = BigInt(to_base);

        let dec_value = value.split("").reverse().reduce((carry, digit, index) => {
            let fromIndex = from_range.indexOf(digit);
            if (fromIndex === -1)
                throw new Error(`Invalid digit ${digit} for base ${from_base}.`);
            return carry + BigInt(fromIndex) * bigIntPow(from_base_big, BigInt(index));
        }, BigInt(0));

        let new_value = "";
        while (dec_value > 0) {
            new_value = to_range[dec_value % to_base_big] + new_value;
            dec_value = (dec_value - dec_value % to_base_big) / to_base_big;
        }
        return new_value || "0";
    };
    let extra_encode = text => convertBaseBigInt(CryptoJS.SHA3(text).toString(CryptoJS.enc.Hex), 16, 93);
    let youtube_sub_channelids = [];

    function send_gg_auth(code, callback, grant_type = "authorization_code") {
        var url = "https://oauth2.googleapis.com/token";

        var xhr = new XMLHttpRequest();
        xhr.open("POST", url);

        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                window.history.pushState('page2', 'Title', new URL(location.href).pathname);
                let token = JSON.parse(xhr.responseText).access_token,
                    refresh_token = JSON.parse(xhr.responseText).refresh_token;
                console.log(getCookie("ggauth_refresh_token"), xhr.responseText, token, refresh_token);
                callback(token, refresh_token);
            }
        };

        var data = "grant_type=" + grant_type + (grant_type == "authorization_code" ? "&code=" : "&refresh_token=") + code + "&client_id=" + client_id + "&client_secret=" + client_secret + "&redirect_uri=" + encodeURIComponent(redirect_uri);

        xhr.send(data);
    }

    function refresh_token(type, callback) {
        let code = (type == "authorization_code" ? new URL(location.href).searchParams.get("code") : getCookie("ggauth_refresh_token"));
        send_gg_auth(code, (token, refresh_token) => {
            if (refresh_token)
                setCookie("ggauth_refresh_token", refresh_token, access_token_cookie_exdays);
            callback(token);
        }, type);
    }

    function get_access_token(callback) {
        if (getCookie("ggauth_refresh_token") && getCookie("ggauth_refresh_token") != "undefined")
            refresh_token("refresh_token", callback);
        else {
            let code_param = new URL(location.href).searchParams.get("code");
            if (code_param)
                refresh_token("authorization_code", callback);
            else
                gg_auth_func();
        }
    }

    function send_ytb_sub(code, callback) {
        fetch("https://youtube.googleapis.com/youtube/v3/subscriptions?part=snippet,contentDetails&maxResults=100&mine=true&key=" + api_key, {
            headers: {
                Accept: "application/json",
                Authorization: "Bearer " + code
            }
        }).then(res => res.json()).then(json => {
            let counter = 0;
            json.items.forEach((channel, index) => {
                fetch("https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=" + channel.snippet.resourceId.channelId.replace("C", "U") + "&key=" + api_key)
                    .then(res => res.json())
                    .then(new_json => {
                        let temp = [];
                        new_json.items.slice(0, channel.contentDetails.newItemCount <= 3 ? 3 : channel.contentDetails.newItemCount).forEach(item => {
                            temp.push({
                                title: item.snippet.title,
                                source: item.snippet.channelTitle,
                                link: "https://youtube.com/watch?v=" + item.snippet.resourceId.videoId,
                                image: item.snippet.thumbnails.default.url,
                                time: item.snippet.publishedAt
                            });
                        });
                        youtube_sub_channelids.push(temp);
                        youtube_sub_channelids = youtube_sub_channelids.flat();
                        counter++;
                        if (counter == json.items.length) callback();
                    });
            });
        });
    }

    function gg_auth_func() {
        location.href = "https://accounts.google.com/o/oauth2/auth/oauthchooseaccount?scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fyoutube.readonly&response_type=code&access_type=offline&redirect_uri=" + encodeURIComponent(redirect_uri) + "&client_id=" + client_id + "&flowName=GeneralOAuthFlow";
    }

    //if (ytb_enabled) {
    get_access_token(access_token => {
        send_ytb_sub(access_token, loadmore_x);
    })
        /* let code_param = new URL(location.href).searchParams.get("code");
if (code_param)
setCookie("ggauth", code_param, access_token_cookie_exdays);
if (save_cookie && getCookie("ggauth") && getCookie("ggauth") != "")
send_gg_auth(getCookie("ggauth"), loadmore_x);
else if (!code_param)
gg_auth_func();
else
send_gg_auth(code_param, loadmore_x); */
    //}
</script>
<button onclick="loadmore(this);" style="position: fixed; bottom: 10px; left: auto; display: none;" id="btn">Tải thêm
    (current: <span>0</span>/
    <script>document.write(link_list.length);</script>)
</button>
